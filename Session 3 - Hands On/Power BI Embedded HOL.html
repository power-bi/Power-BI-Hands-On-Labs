<!DOCTYPE html>
<html>
<head>
<title>readme</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<style type="text/css">
/* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
/* Author: Nicolas Hery - http://nicolashery.com */
/* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
/* Source: https://github.com/nicolahery/markdownpad-github */

/* RESET
=============================================================================*/

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video {
  margin: 0;
  padding: 0;
  border: 0;
}

/* BODY
=============================================================================*/

body {
  font-family: Helvetica, arial, freesans, clean, sans-serif;
  font-size: 14px;
  line-height: 1.6;
  color: #333;
  background-color: #fff;
  padding: 20px;
  max-width: 960px;
  margin: 0 auto;
}

body>*:first-child {
  margin-top: 0 !important;
}

body>*:last-child {
  margin-bottom: 0 !important;
}

/* BLOCKS
=============================================================================*/

p, blockquote, ul, ol, dl, table, pre {
  margin: 15px 0;
}

/* HEADERS
=============================================================================*/

h1, h2, h3, h4, h5, h6 {
  margin: 20px 0 10px;
  padding: 0;
  font-weight: bold;
  -webkit-font-smoothing: antialiased;
}

h1 tt, h1 code, h2 tt, h2 code, h3 tt, h3 code, h4 tt, h4 code, h5 tt, h5 code, h6 tt, h6 code {
  font-size: inherit;
}

h1 {
  font-size: 28px;
  color: #000;
}

h2 {
  font-size: 24px;
  border-bottom: 1px solid #ccc;
  color: #000;
}

h3 {
  font-size: 18px;
}

h4 {
  font-size: 16px;
}

h5 {
  font-size: 14px;
}

h6 {
  color: #777;
  font-size: 14px;
}

body>h2:first-child, body>h1:first-child, body>h1:first-child+h2, body>h3:first-child, body>h4:first-child, body>h5:first-child, body>h6:first-child {
  margin-top: 0;
  padding-top: 0;
}

a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 {
  margin-top: 0;
  padding-top: 0;
}

h1+p, h2+p, h3+p, h4+p, h5+p, h6+p {
  margin-top: 10px;
}

/* LINKS
=============================================================================*/

a {
  color: #4183C4;
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}

/* LISTS
=============================================================================*/

ul, ol {
  padding-left: 30px;
}

ul li > :first-child, 
ol li > :first-child, 
ul li ul:first-of-type, 
ol li ol:first-of-type, 
ul li ol:first-of-type, 
ol li ul:first-of-type {
  margin-top: 0px;
}

ul ul, ul ol, ol ol, ol ul {
  margin-bottom: 0;
}

dl {
  padding: 0;
}

dl dt {
  font-size: 14px;
  font-weight: bold;
  font-style: italic;
  padding: 0;
  margin: 15px 0 5px;
}

dl dt:first-child {
  padding: 0;
}

dl dt>:first-child {
  margin-top: 0px;
}

dl dt>:last-child {
  margin-bottom: 0px;
}

dl dd {
  margin: 0 0 15px;
  padding: 0 15px;
}

dl dd>:first-child {
  margin-top: 0px;
}

dl dd>:last-child {
  margin-bottom: 0px;
}

/* CODE
=============================================================================*/

pre, code, tt {
  font-size: 12px;
  font-family: Consolas, "Liberation Mono", Courier, monospace;
}

code, tt {
  margin: 0 0px;
  padding: 0px 0px;
  white-space: nowrap;
  border: 1px solid #eaeaea;
  background-color: #f8f8f8;
  border-radius: 3px;
}

pre>code {
  margin: 0;
  padding: 0;
  white-space: pre;
  border: none;
  background: transparent;
}

pre {
  background-color: #f8f8f8;
  border: 1px solid #ccc;
  font-size: 13px;
  line-height: 19px;
  overflow: auto;
  padding: 6px 10px;
  border-radius: 3px;
}

pre code, pre tt {
  background-color: transparent;
  border: none;
}

kbd {
    -moz-border-bottom-colors: none;
    -moz-border-left-colors: none;
    -moz-border-right-colors: none;
    -moz-border-top-colors: none;
    background-color: #DDDDDD;
    background-image: linear-gradient(#F1F1F1, #DDDDDD);
    background-repeat: repeat-x;
    border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
    border-image: none;
    border-radius: 2px 2px 2px 2px;
    border-style: solid;
    border-width: 1px;
    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
    line-height: 10px;
    padding: 1px 4px;
}

/* QUOTES
=============================================================================*/

blockquote {
  border-left: 4px solid #DDD;
  padding: 0 15px;
  color: #777;
}

blockquote>:first-child {
  margin-top: 0px;
}

blockquote>:last-child {
  margin-bottom: 0px;
}

/* HORIZONTAL RULES
=============================================================================*/

hr {
  clear: both;
  margin: 15px 0;
  height: 0px;
  overflow: hidden;
  border: none;
  background: transparent;
  border-bottom: 4px solid #ddd;
  padding: 0;
}

/* TABLES
=============================================================================*/

table th {
  font-weight: bold;
}

table th, table td {
  border: 1px solid #ccc;
  padding: 6px 13px;
}

table tr {
  border-top: 1px solid #ccc;
  background-color: #fff;
}

table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

/* IMAGES
=============================================================================*/

img {
  max-width: 100%
}
</style>
<style type="text/css">
.highlight  { background: #ffffff; }
.highlight .c { color: #999988; font-style: italic } /* Comment */
.highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .k { font-weight: bold } /* Keyword */
.highlight .o { font-weight: bold } /* Operator */
.highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
.highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
.highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
.highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #aa0000 } /* Generic.Error */
.highlight .gh { color: #999999 } /* Generic.Heading */
.highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #555555 } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #aaaaaa } /* Generic.Subheading */
.highlight .gt { color: #aa0000 } /* Generic.Traceback */
.highlight .kc { font-weight: bold } /* Keyword.Constant */
.highlight .kd { font-weight: bold } /* Keyword.Declaration */
.highlight .kp { font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #009999 } /* Literal.Number */
.highlight .s { color: #d14 } /* Literal.String */
.highlight .na { color: #008080 } /* Name.Attribute */
.highlight .nb { color: #0086B3 } /* Name.Builtin */
.highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
.highlight .no { color: #008080 } /* Name.Constant */
.highlight .ni { color: #800080 } /* Name.Entity */
.highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
.highlight .nn { color: #555555 } /* Name.Namespace */
.highlight .nt { color: #000080 } /* Name.Tag */
.highlight .nv { color: #008080 } /* Name.Variable */
.highlight .ow { font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #009999 } /* Literal.Number.Float */
.highlight .mh { color: #009999 } /* Literal.Number.Hex */
.highlight .mi { color: #009999 } /* Literal.Number.Integer */
.highlight .mo { color: #009999 } /* Literal.Number.Oct */
.highlight .sb { color: #d14 } /* Literal.String.Backtick */
.highlight .sc { color: #d14 } /* Literal.String.Char */
.highlight .sd { color: #d14 } /* Literal.String.Doc */
.highlight .s2 { color: #d14 } /* Literal.String.Double */
.highlight .se { color: #d14 } /* Literal.String.Escape */
.highlight .sh { color: #d14 } /* Literal.String.Heredoc */
.highlight .si { color: #d14 } /* Literal.String.Interpol */
.highlight .sx { color: #d14 } /* Literal.String.Other */
.highlight .sr { color: #009926 } /* Literal.String.Regex */
.highlight .s1 { color: #d14 } /* Literal.String.Single */
.highlight .ss { color: #990073 } /* Literal.String.Symbol */
.highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #008080 } /* Name.Variable.Class */
.highlight .vg { color: #008080 } /* Name.Variable.Global */
.highlight .vi { color: #008080 } /* Name.Variable.Instance */
.highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
.pl-c {
    color: #969896;
}

.pl-c1,.pl-mdh,.pl-mm,.pl-mp,.pl-mr,.pl-s1 .pl-v,.pl-s3,.pl-sc,.pl-sv {
    color: #0086b3;
}

.pl-e,.pl-en {
    color: #795da3;
}

.pl-s1 .pl-s2,.pl-smi,.pl-smp,.pl-stj,.pl-vo,.pl-vpf {
    color: #333;
}

.pl-ent {
    color: #63a35c;
}

.pl-k,.pl-s,.pl-st {
    color: #a71d5d;
}

.pl-pds,.pl-s1,.pl-s1 .pl-pse .pl-s2,.pl-sr,.pl-sr .pl-cce,.pl-sr .pl-sra,.pl-sr .pl-sre,.pl-src,.pl-v {
    color: #df5000;
}

.pl-id {
    color: #b52a1d;
}

.pl-ii {
    background-color: #b52a1d;
    color: #f8f8f8;
}

.pl-sr .pl-cce {
    color: #63a35c;
    font-weight: bold;
}

.pl-ml {
    color: #693a17;
}

.pl-mh,.pl-mh .pl-en,.pl-ms {
    color: #1d3e81;
    font-weight: bold;
}

.pl-mq {
    color: #008080;
}

.pl-mi {
    color: #333;
    font-style: italic;
}

.pl-mb {
    color: #333;
    font-weight: bold;
}

.pl-md,.pl-mdhf {
    background-color: #ffecec;
    color: #bd2c00;
}

.pl-mdht,.pl-mi1 {
    background-color: #eaffea;
    color: #55a532;
}

.pl-mdr {
    color: #795da3;
    font-weight: bold;
}

.pl-mo {
    color: #1d3e81;
}
.task-list {
padding-left:10px;
margin-bottom:0;
}

.task-list li {
    margin-left: 20px;
}

.task-list-item {
list-style-type:none;
padding-left:10px;
}

.task-list-item label {
font-weight:400;
}

.task-list-item.enabled label {
cursor:pointer;
}

.task-list-item+.task-list-item {
margin-top:3px;
}

.task-list-item-checkbox {
display:inline-block;
margin-left:-20px;
margin-right:3px;
vertical-align:1px;
}
</style>
</head>
<body>
<p><a name="HOLTitle"></a></p>
<h1>Using Microsoft Power BI Embedded to Show Reports in Cross-Platform Mobile Apps</h1>
<hr>
<p><a name="Overview"></a></p>
<h2>Overview</h2>
<p><a href="https://powerbi.microsoft.com/en-us/mobile/">Microsoft Power BI</a> was created to address the data explosion in commercial and academic organizations, the need to analyze that data, and the need for rich, interactive visuals to represent the data and reveal key insights. It contains a suite of tools that assist in the full life cycle of data analysis, from data discovery and collection to data transformation, aggregation, visualization, sharing, and collaboration. Moreover, it allows you to create rich visualizations without writing any code and present them in interactive dashboards.</p>
<p><a href="https://azure.microsoft.com/en-us/services/power-bi-embedded/" title="Microsoft Power BI Embedded">Microsoft Power BI Embedded</a> is an Azure service that enables developers to surface Power BI reports in their apps and Web sites without requiring users to have Power BI accounts of their own. Reports are created in <a href="https://powerbi.microsoft.com/desktop/">Power BI Desktop</a> and saved as PBIX files. These PBIX files are then imported into Power BI Embedded using APIs provided for that purpose and used to embed interactive charts and graphs. The process is accomplished primarily through calls to REST APIs (or SDKs that wrap those APIs) and is well documented in articles such as <a href="https://docs.microsoft.com/azure/power-bi-embedded/power-bi-embedded-get-started">Get started with Microsoft Power BI Embedded</a> and <a href="https://docs.microsoft.com/azure/power-bi-embedded/power-bi-embedded-embed-report">Embed a report in Power BI Embedded</a>. What is not so well documented is how to surface Power BI Embedded reports in cross-platform mobile apps such as ones built with <a href="https://www.xamarin.com/">Xamarin</a>.</p>
<p>In this lab, you will use Visual Studio 2017 to create a Xamarin Forms app that runs on iOS, Android, and Windows, and that embeds a report created with Power BI Desktop. The report provides a graphical depiction of Twitter activity in a selected region of the United States. Once running, the report appears to be part of the app itself because it is tightly integrated. The smarts, however, come from Power BI Embedded.</p>
<p><a name="Objectives"></a></p>
<h3>Objectives</h3>
<p>In this hands-on lab, you will learn how to:</p>
<ul>
<li>Create a Power BI Embedded workspace collection</li>
<li>Create a Xamarin Forms app in Visual Studio 2017</li>
<li>Write code to import a Power BI Embedded report</li>
<li>Write code to track Twitter activity and stream it to a Power BI dataset</li>
<li>Create an Azure Mobile App that hosts a Power BI Embedded report</li>
<li>Embed the report a Xamarin Forms app that runs on Android, iOS, and Windows</li>
</ul>
<p><a name="Prerequisites"></a></p>
<h3>Prerequisites</h3>
<p>The following are required to complete this hands-on lab:</p>
<ul>
<li><a href="https://www.visualstudio.com/">Visual Studio Community 2017</a> or higher with the following workloads installed:
<ul>
<li>.NET desktop development workload</li>
<li>Universal Windows Platform development workload</li>
<li>Mobile development with .NET workload</li>
</ul>
</li>
<li>An active Microsoft Azure subscription. If you don't have one, <a href="http://aka.ms/WATK-FreeTrial">sign up for a free trial</a></li>
<li>A Twitter account. If you don't have one, <a href="http://www.twitter.com">sign up for free</a></li>
</ul>
<p>If you wish to build and run the iOS version of the app, you also have to have a Mac running OS X 10.11 or higher, and both the Mac and the PC running Visual Studio 2017 require further configuration. For details, see <a href="https://developer.xamarin.com/guides/ios/getting_started/installation/windows/">https://developer.xamarin.com/guides/ios/getting_started/installation/windows/</a>.</p>
<blockquote>
<p>Having a Mac and connecting it to Visual Studio is <strong>only required</strong> if you wish to build and run the iOS version of the app. You can run the Android and Windows versions of the app without any further configuration.</p>
</blockquote>
<hr>
<p><a name="Exercises"></a></p>
<h2>Exercises</h2>
<p>This hands-on lab includes the following exercises:</p>
<ul>
<li><a href="#Exercise1">Exercise 1: Create a Power BI Embedded workspace collection</a></li>
<li><a href="#Exercise2">Exercise 2: Create a Xamarin Forms app</a></li>
<li><a href="#Exercise3">Exercise 3: Import a Power BI Embedded report</a></li>
<li><a href="#Exercise4">Exercise 4: Register a Twitter app</a></li>
<li><a href="#Exercise5">Exercise 5: Write code to track Twitter activity</a></li>
<li><a href="#Exercise6">Exercise 6: Create a Power BI report viewer in an Azure Mobile App</a></li>
<li><a href="#Exercise7">Exercise 7: Connect the Xamarin Forms app to the report viewer</a></li>
</ul>
<p>Estimated time to complete this lab: <strong>60</strong> minutes.</p>
<p><a name="Exercise1"></a></p>
<h2>Exercise 1: Create a Power BI Embedded workspace collection</h2>
<p>In order to embed a report in a Web site or app with Power BI Embedded, you must first create a Power BI Embedded workspace. And to create a Power BI Embedded workspace, you must first create a Power BI Embedded workspace collection to put it in. Workspaces can only be created programmatically, but workspace collections can be created programmatically or through the Azure Portal. In this exercise, you will use the Azure Portal to create a Power BI Embedded workspace collection.</p>
<ol>
<li>
<p>Open the <a href="https://portal.azure.com">Azure Portal</a> in your browser. If asked to sign in, do so using your Microsoft account.</p>
</li>
<li>
<p>Click <strong>+ New</strong>, followed by <strong>Intelligence + analytics</strong> and <strong>Power BI Embedded</strong>.</p>
<p><a href="Images/portal-add-new.png" target="_blank"><img src="Images/portal-add-new.png" alt="Creating a Power BI Embedded workspace collection" style="max-width:100%;"></a></p>
<p><em>Creating a Power BI Embedded workspace collection</em></p>
</li>
<li>
<p>Enter a unique name as the <strong>Workspace Collection Name</strong> and make sure a green check mark appears next to it indicating that the name is valid and unique. Under <strong>Resource Group</strong>, select <strong>Create new</strong> and enter "PowerBIResources" (without quotation marks) as the resource-group name. Choose the <strong>Location</strong> nearest you, and accept the default values for all other parameters. Then click <strong>Create</strong>.</p>
<p><a href="Images/portal-create-collection.png" target="_blank"><img src="Images/portal-create-collection.png" alt="Creating a Power BI Embedded workspace collection" style="max-width:100%;"></a></p>
<p><em>Creating a Power BI Embedded workspace collection</em></p>
</li>
<li>
<p>Click <strong>Resource groups</strong> in the ribbon on the left side of the portal, and then click the resource group created for the Power BI Embedded workspace collection.</p>
<p><a href="Images/open-resource-group.png" target="_blank"><img src="Images/open-resource-group.png" alt="Opening the resource group" style="max-width:100%;"></a></p>
<p><em>Opening the resource group</em></p>
</li>
<li>
<p>Wait until "Deploying" changes to "Succeeded," indicating that the workspace collection has been deployed. (You can click the <strong>Refresh</strong> button at the top of the blade to refresh the deployment status.) Then click the workspace collection.</p>
<p><a href="Images/portal-powerbiresources.png" target="_blank"><img src="Images/portal-powerbiresources.png" alt="Opening the workspace collection" style="max-width:100%;"></a></p>
<p><em>Opening the workspace collection</em></p>
</li>
<li>
<p>Click <strong>Access keys</strong>, and then click the <strong>Copy</strong> button to the right of <strong>KEY 1</strong> to copy the access key to the clipboard. Paste the key into your favorite text editor so you can easily retrieve it later. You will need it in <a href="#Exercise4">Exercise 4</a>.</p>
<p><a href="Images/portal-copy-key1.png" target="_blank"><img src="Images/portal-copy-key1.png" alt="Copying the access key to the clipboard" style="max-width:100%;"></a></p>
<p><em>Copying the access key to the clipboard</em></p>
</li>
</ol>
<p>This access key is important because it is used to create <em>access tokens</em> that enable apps to authenticate to Power BI Embedded and embed reports. Two keys are generated, but only one is needed at any given time. The second key is provided so you can periodically refresh the keys in your apps without interrupting access to the service.</p>
<p><a name="Exercise2"></a></p>
<h2>Exercise 2: Create a Xamarin Forms app</h2>
<p>In this exercise, you will create a new Xamarin Forms solution in Visual Studio and add basic infrastructure to customize the app's branding and lay the groundwork for hosting a Power BI Embedded report. If you have not installed the workloads listed in the <a href="#Prerequisites">Prerequisites</a> section, stop now and modify your Visual Studio installation to add these workloads.</p>
<ol>
<li>
<p>Start Visual Studio, and use the <strong>File</strong> -&gt; <strong>New</strong> -&gt; <strong>Project</strong> command to create a new <strong>Cross Platform App</strong> solution named "TwitterBI."</p>
<p><a href="Images/vs-create-new-xplat.png" target="_blank"><img src="Images/vs-create-new-xplat.png" alt="Creating a solution in Visual Studio 2017" style="max-width:100%;"></a></p>
<p><em>Creating a solution in Visual Studio 2017</em></p>
</li>
<li>
<p>In the "New Cross Platform App" dialog, select the <strong>Blank App</strong> template. Make sure <strong>Xamarin.Forms</strong> is selected under "UI Technology" and select <strong>Portable Class Library (PCL)</strong> as the "Code Sharing Strategy." Then click <strong>OK</strong>.</p>
<p><a href="Images/vs-select-blank-app.png" target="_blank"><img src="Images/vs-select-blank-app.png" alt="Creating a Cross Platform App" style="max-width:100%;"></a></p>
<p><em>Creating a Cross Platform App</em></p>
</li>
<li>
<p>When prompted to choose platform requirements for the Universal Windows Platform project, accept the defaults and click <strong>OK</strong>.</p>
<p><a href="Images/vs-target-platform.png" target="_blank"><img src="Images/vs-target-platform.png" alt="Specifying UWP platform versions" style="max-width:100%;"></a></p>
<p><em>Specifying UWP platform versions</em></p>
</li>
<li>
<p>Confirm that the solution appears in Solution Explorer and that it contains four projects:</p>
<ul>
<li><strong>TwitterBI (Portable)</strong> - Contains shared logic for your  Xamarin Forms app</li>
<li><strong>TwitterBI.Android</strong> - Contains assets, resources, and logic specific to Android</li>
<li><strong>TwitterBI.iOS</strong> - Contains assets, resources, and logic specific to iOS</li>
<li><strong>TwitterBI.UWP (Universal Windows)</strong> - Contains assets, resources, and logic specific to the Universal Windows Platform (UWP)</li>
</ul>
<p><a href="Images/vs-new-projects.png" target="_blank"><img src="Images/vs-new-projects.png" alt="The generated solution" style="max-width:100%;"></a></p>
<p><em>The generated solution</em></p>
</li>
<li>
<p>Right-click the <strong>TwitterBI.Android</strong> project in and select <strong>Properties</strong> from the context menu. Then click <strong>Android Options</strong> and uncheck the <strong>Use Fast Deployment (debug mode only)</strong> box. This option, if enabled, sometimes causes problems with Android emulators hosted by Hyper-V.</p>
<p><a href="Images/disable-fast-deployment.png" target="_blank"><img src="Images/disable-fast-deployment.png" alt="Disabling fast deployment on Android" style="max-width:100%;"></a></p>
<p><em>Disabling fast deployment on Android</em></p>
</li>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBI</strong> solution and select <strong>Build Solution</strong> to build the solution. Make sure the solution builds without errors.</p>
<p><a href="Images/vs-build-solution.png" target="_blank"><img src="Images/vs-build-solution.png" alt="Building the solution" style="max-width:100%;"></a></p>
<p><em>Building the solution</em></p>
</li>
<li>
<p>Right-click the <strong>TwitterBI (Portable)</strong> project and use the <strong>Add</strong> -&gt; <strong>New Folder</strong> command to add a folder named "Common" to the project.</p>
<p><a href="Images/vs-add-new-folder.png" target="_blank"><img src="Images/vs-add-new-folder.png" alt="Adding a new folder to the PCL project" style="max-width:100%;"></a></p>
<p><em>Adding a new folder to the PCL project</em></p>
</li>
<li>
<p>Right-click the "Common" folder that you just added. Select <strong>Add</strong> -&gt; <strong>Existing Item...</strong> and browse to the "Resources\Common" folder included with this lab. Select all of the files in that folder and click <strong>Add</strong></p>
<p><a href="Images/vs-add-common-files.png" target="_blank"><img src="Images/vs-add-common-files.png" alt="Adding files to the PCL project" style="max-width:100%;"></a></p>
<p><em>Adding files to the PCL project</em></p>
</li>
<li>
<p>Right-click the <strong>TwitterBI (Portable)</strong> project again and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>MainViewModel.cs</strong> to the project.</p>
<p><a href="Images/vs-add-mainviewmodel-class.png" target="_blank"><img src="Images/vs-add-mainviewmodel-class.png" alt="Adding the MainViewModel class" style="max-width:100%;"></a></p>
<p><em>Adding the MainViewModel class</em></p>
</li>
<li>
<p>Open <strong>App.xaml.cs</strong> in the <strong>TwitterBI (Portable)</strong> project and insert the following line of code directly above the <code>App</code> class constructor:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-en">MainViewModel</span> ViewModel { <span class="pl-k">get</span>; <span class="pl-k">set</span>; }</pre></div>
</li>
<li>
<p>Still in <strong>App.xaml.cs</strong>, replace the line of code that initializes the <code>MainPage</code> property in the class constructor with the following line of code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-en">MainPage</span> = new <span class="pl-en">NavigationPage</span>(<span class="pl-en">new</span> <span class="pl-smi">TwitterBI</span>.MainPage());</pre></div>
<p><a href="Images/vs-update-app-file.png" target="_blank"><img src="Images/vs-update-app-file.png" alt="Updating App.xaml.cs" style="max-width:100%;"></a></p>
<p><em>Updating App.xaml.cs</em></p>
</li>
<li>
<p>Open a Windows File Explorer window and navigate to the "Resources\Android\Resources" folder included with this lab. Copy all of the subfolders in the "Resources\Android\Resources" folder to the clipboard. Then return to Solution Explorer, right-click the "Resources" folder in the <strong>TwitterBI.Android</strong> project, and select <strong>Paste</strong> to paste the contents of the clipboard into the project.</p>
<p><a href="Images/fe-add-droid-resources.png" target="_blank"><img src="Images/fe-add-droid-resources.png" alt="Importing Android assets" style="max-width:100%;"></a></p>
<p><em>Importing Android assets</em></p>
</li>
<li>
<p>In the subsequent "Merge Folders" dialog, check <strong>Apply to all items</strong> and then click <strong>Yes</strong>.</p>
<p><a href="Images/vs-droid-merge-folders.png" target="_blank"><img src="Images/vs-droid-merge-folders.png" alt="Merging existing files" style="max-width:100%;"></a></p>
<p><em>Merging existing files</em></p>
</li>
<li>
<p>In the "Destination File Exists" dialog, again check <strong>Apply to all items</strong> and then click <strong>Yes</strong>. This will update the default Android assets with custom-branded assets.</p>
<p><a href="Images/vs-overwrite-droid-files.png" target="_blank"><img src="Images/vs-overwrite-droid-files.png" alt="Overwriting existing files" style="max-width:100%;"></a></p>
<p><em>Overwriting existing files</em></p>
</li>
<li>
<p>In Solution Explorer, right-click the "Resources" folder in the <strong>TwitterBI.iOS</strong> project and select <strong>Add</strong> -&gt; <strong>Existing Item...</strong>. Then browse to the "Resources\iOS\Resources" folder included with this lab, select all of the files in that folder, and click <strong>Add</strong>.</p>
<p><a href="Images/vs-overwrite-ios-files.png" target="_blank"><img src="Images/vs-overwrite-ios-files.png" alt="Adding images to the iOS project" style="max-width:100%;"></a></p>
<p><em>Adding images to the iOS project</em></p>
</li>
<li>
<p>In the "Destination File Exists" dialog, check <strong>Apply to all items</strong> and then click <strong>Yes</strong>. This will update the default iOS assets with custom-branded assets.</p>
</li>
<li>
<p>Open <strong>Info.plist</strong> in the <strong>TwitterBI.iOS</strong> project. Scroll to the bottom of the file, right-click <strong>Launch screen interface file base name</strong>, and select <strong>Delete</strong>.</p>
<p><a href="Images/vs-delete-plist-entry.png" target="_blank"><img src="Images/vs-delete-plist-entry.png" alt="Modifying Info.plist" style="max-width:100%;"></a></p>
<p><em>Modifying Info.plist</em></p>
</li>
<li>
<p>Right-click the "Assets" folder in the <strong>TwitterBI.UWP (Windows Universal)</strong> project and select <strong>Add</strong> -&gt; <strong>Existing Item...</strong>. Then browse to the "Resources\UWP\Assets" folder included with this lab, select all of the files in that folder, and click <strong>Add</strong>.</p>
<p><a href="Images/fe-add-uwp-assets.png" target="_blank"><img src="Images/fe-add-uwp-assets.png" alt="Adding images to the Windows project" style="max-width:100%;"></a></p>
<p><em>Adding images to the Windows project</em></p>
</li>
<li>
<p>In Solution Explorer, right-click <strong>Package.appxmanifest</strong> in the UWP project and select <strong>View Code</strong>. Replace the <code>Applications</code> element inside the file with this one:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">Applications</span>&gt;
  &lt;<span class="pl-ent">Application</span> <span class="pl-e">Id</span>=<span class="pl-s"><span class="pl-pds">"</span>App<span class="pl-pds">"</span></span> <span class="pl-e">Executable</span>=<span class="pl-s"><span class="pl-pds">"</span>$targetnametoken$.exe<span class="pl-pds">"</span></span> <span class="pl-e">EntryPoint</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBI.UWP.App<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">uap</span><span class="pl-ent">:</span><span class="pl-ent">VisualElements</span> <span class="pl-e">DisplayName</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBI<span class="pl-pds">"</span></span> <span class="pl-e">Square150x150Logo</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\MediumTile.png<span class="pl-pds">"</span></span> <span class="pl-e">Square44x44Logo</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\AppIcon.png<span class="pl-pds">"</span></span> <span class="pl-e">Description</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBI for Windows<span class="pl-pds">"</span></span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#F2C811<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">uap</span><span class="pl-ent">:</span><span class="pl-ent">DefaultTile</span> <span class="pl-e">Wide310x150Logo</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\WideTile.png<span class="pl-pds">"</span></span> <span class="pl-e">Square310x310Logo</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\LargeTile.png<span class="pl-pds">"</span></span> <span class="pl-e">Square71x71Logo</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\SmallTile.png<span class="pl-pds">"</span></span>&gt;
      &lt;/<span class="pl-ent">uap</span><span class="pl-ent">:</span><span class="pl-ent">DefaultTile</span>&gt;
      &lt;<span class="pl-ent">uap</span><span class="pl-ent">:</span><span class="pl-ent">SplashScreen</span> <span class="pl-e">Image</span>=<span class="pl-s"><span class="pl-pds">"</span>Assets\SplashLogo.png<span class="pl-pds">"</span></span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#F2C811<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">uap</span><span class="pl-ent">:</span><span class="pl-ent">VisualElements</span>&gt;
  &lt;/<span class="pl-ent">Application</span>&gt;
&lt;/<span class="pl-ent">Applications</span>&gt;</pre></div>
</li>
<li>
<p>Now it's time to run the app for the first time, starting with the Android version. Ensure that the Android project is selected as the startup project by right-clicking the <strong>TwitterBI.Android</strong> project in Solution Explorer and selecting <strong>Set as StartUp Project</strong>.</p>
<p><a href="Images/vs-set-as-startup.png" target="_blank"><img src="Images/vs-set-as-startup.png" alt="Setting a project as the startup project" style="max-width:100%;"></a></p>
<p><em>Setting a project as the startup project</em></p>
</li>
<li>
<p>Select the emulator you want to run the app in and click the <strong>Run</strong> button (the one with the green arrow) at the top of Visual Studio to launch the Android version of the app. Note that the emulator will probably take a minute or two to start.</p>
<p><a href="Images/vs-run-droid.png" target="_blank"><img src="Images/vs-run-droid.png" alt="Launching the Android app" style="max-width:100%;"></a></p>
<p><em>Launching the Android app</em></p>
</li>
<li>
<p>Confirm that the app appears in the Android emulator. Leave the emulator running (that will allow the Android app to start quickly next time). Then return to Visual Studio and select <strong>Stop Debugging</strong> from the <strong>Debug</strong> menu to stop debugging.</p>
</li>
<li>
<p>Open the Settings app on your PC (an easy way to do it is to click the Windows button, type "Settings," and click <strong>Settings</strong>). Then click <strong>Update &amp; security</strong> followed by <strong>For developers</strong>, and select <strong>Developer mode</strong> if it isn't already selected.</p>
<blockquote>
<p>If you try to enable developer mode and receive an error, see <a href="https://www.kapilarya.com/developer-mode-package-failed-to-install-error-code-0x80004005-windows-10">https://www.kapilarya.com/developer-mode-package-failed-to-install-error-code-0x80004005-windows-10</a> for a potential fix.</p>
</blockquote>
<p><a href="Images/developer-mode.png" target="_blank"><img src="Images/developer-mode.png" alt="Enabling developer mode in Windows 10" style="max-width:100%;"></a></p>
<p><em>Enabling developer mode in Windows 10</em></p>
</li>
<li>
<p>Make <strong>TwitterBI.UWP</strong> the startup project by right-clicking it and selecting <strong>Set as StartUp Project</strong>. Then deploy the UWP app to your computer by right-clicking the project in Solution Explorer and selecting <strong>Deploy</strong>.</p>
</li>
<li>
<p>Click the <strong>Run</strong> button at the top of Visual Studio to launch the UWP version of TwitterBI on the local machine.</p>
<blockquote>
<p>If you would prefer to run the UWP app in a Windows phone emulator rather than on the desktop, simply select the desired emulator from the drop-down list attached to the <strong>Run</strong> button.</p>
</blockquote>
<p><a href="Images/vs-run-uwp.png" target="_blank"><img src="Images/vs-run-uwp.png" alt="Launching the UWP app" style="max-width:100%;"></a></p>
<p><em>Launching the UWP app</em></p>
</li>
<li>
<p>Confirm that the app appears on the screen. Then return to Visual Studio and select <strong>Stop Debugging</strong> from the <strong>Debug</strong> menu to stop debugging.</p>
</li>
<li>
<p>If you configured Visual Studio to build iOS projects, make <strong>TwitterBI.iOS</strong> the startup project and click the <strong>Run</strong> button to launch it in the iOS simulator.</p>
<blockquote>
<p>Remember that you can only build and run the iOS version of the app if you configured a Mac to serve as the build host and connected Visual Studio to the Mac. For more information, see <a href="https://developer.xamarin.com/guides/ios/getting_started/installation/windows/">https://developer.xamarin.com/guides/ios/getting_started/installation/windows/</a>.</p>
</blockquote>
</li>
<li>
<p>Confirm that the app appears in the iOS emulator. Then return to Visual Studio and select <strong>Stop Debugging</strong> from the <strong>Debug</strong> menu to stop debugging.</p>
</li>
</ol>
<p>The app doesn't do anything yet, but it is branded with splash screens, icons, and other visual assets that give it an identity of its own. Now it's time to add code to make the app do something useful.</p>
<p><a href="Images/app-updated-branding.png" target="_blank"><img src="Images/app-updated-branding.png" alt="Branded splash screens and visual assets" style="max-width:100%;"></a></p>
<p><em>Branded splash screens and visual assets</em></p>
<p><a name="Exercise3"></a></p>
<h2>Exercise 3: Import a Power BI Embedded report</h2>
<p>In this exercise, you will write code to create a Power BI Embedded workspace and import a Power BI report. Then you will run the app and execute the code. These are steps that <em>every app that hosts a Power BI Embedded report must do</em>, and that can <em>only be performed programmatically</em>.</p>
<ol>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBI</strong> solution and select <strong>Manage NuGet Packages for Solutionâ€¦</strong>.</p>
<p><a href="Images/vs-select-nuget-solutions.png" target="_blank"><img src="Images/vs-select-nuget-solutions.png" alt="Managing NuGet packages for the solution" style="max-width:100%;"></a></p>
<p><em>Managing NuGet packages for the solution</em></p>
</li>
<li>
<p>Make sure <strong>Browse</strong> is selected in the NuGet Package Manager. Then type "Microsoft.Rest.ClientRuntime" into the search box and select the <strong>Microsoft.Rest.ClientRuntime</strong> package. Check the boxes next to the <strong>TwitterBI.Android</strong> and <strong>TwitterBI.iOS</strong> projects and click <strong>Install</strong> to install the package into these projects. If prompted to review changes, click <strong>OK</strong>. If prompted to accept a license, click <strong>I Accept</strong>.</p>
<p><a href="Images/nuget-rest-client.png" target="_blank"><img src="Images/nuget-rest-client.png" alt="Installing Microsoft.Rest.ClientRuntime" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.Rest.ClientRuntime</em></p>
</li>
<li>
<p>Type "Microsoft.PowerBI.Api" into the search box and select the <strong>Microsoft.PowerBI.Api</strong> package. Check the boxes next to the <strong>TwitterBI.Android</strong>, <strong>TwitterBI.iOS</strong>, and <strong>TwitterBI.UWP</strong> projects and click <strong>Install</strong> to install the package into these projects. If prompted to review changes, click <strong>OK</strong>. If prompted to accept a license, click <strong>I Accept</strong>.</p>
<p><a href="Images/nuget-powerbi.png" target="_blank"><img src="Images/nuget-powerbi.png" alt="Installing Microsoft.PowerBI.Api" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.PowerBI.Api</em></p>
</li>
<li>
<p>Repeat this process to install <strong>Newtonsoft.Json</strong> into <em>all</em> of the projects.</p>
<p><a href="Images/nuget-json-net.png" target="_blank"><img src="Images/nuget-json-net.png" alt="Installing Newtonsoft.Json" style="max-width:100%;"></a></p>
<p><em>Installing Newtonsoft.Json</em></p>
</li>
<li>
<p>Repeat this process one more time to install <strong>Microsoft.Net.Http</strong> into the <strong>TwitterBI</strong> project.</p>
<p><a href="Images/nuget-http-net.png" target="_blank"><img src="Images/nuget-http-net.png" alt="Installing Microsoft.Net.Http" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.Net.Http</em></p>
</li>
<li>
<p>Open <strong>CoreConstants.cs</strong> in the "Common" folder of the <strong>TwitterBI (Portable)</strong> project and add the following class definition:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIConstants</span>
{
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">WorkspaceCollectionName</span> = <span class="pl-s"><span class="pl-pds">"</span>twitterbi<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">WorkspaceName</span> = <span class="pl-s"><span class="pl-pds">"</span>TwitterActivity<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">AccessKey</span> = <span class="pl-s"><span class="pl-pds">"</span>POWER_BI_EMBEDDED_ACCESS_KEY<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">DatasetUserName</span> = <span class="pl-s"><span class="pl-pds">"</span>powerbiuser<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">DatasetPassword</span> = <span class="pl-s"><span class="pl-pds">"</span>PowerBIRocks!<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">ReportLocation</span> = <span class="pl-pds">$"</span><span class="pl-s">https://traininglabservices.azurewebsites.net/PowerBIImports/</span>{WorkspaceName}<span class="pl-s">.zip</span><span class="pl-pds">"</span>;
}</pre></div>
</li>
<li>
<p>Replace <em>POWER_BI_EMBEDDED_ACCESS_KEY</em> in the code that you just added with the access key that you saved in Exercise 1, Step 6. This is the access key that your code will use to generate an access token for authenticating to Power BI Embedded.</p>
<p><a href="Images/vs-updated-accesskey.png" target="_blank"><img src="Images/vs-updated-accesskey.png" alt="Adding the access key" style="max-width:100%;"></a></p>
<p><em>Adding the access key</em></p>
</li>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBI (Portable)</strong> project and use the <strong>Add</strong> -&gt; <strong>New Folder</strong> command to add a folder named "Interfaces" to the project.</p>
</li>
<li>
<p>Right-click the "Interfaces" folder and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>IPowerBIService.cs</strong> to the folder. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI</span>
{
    <span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">IPowerBIService</span>
    {
        <span class="pl-en">Task</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">CreateWorkspaceAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetWorkspaceIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetReportIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetDatasetIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">UpdateConnectionCredentialsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>, <span class="pl-k">string</span> <span class="pl-smi">username</span>, <span class="pl-k">string</span> <span class="pl-smi">password</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteDatasetAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteReportAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
        <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ImportPbixAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetName</span>, <span class="pl-k">byte</span>[] <span class="pl-smi">file</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>);
    }
}</pre></div>
</li>
<li>
<p>Add a folder named "Helpers" to the <strong>TwitterBI (Portable)</strong> project. Right-click the "Helpers" folder and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>PowerBIHelper.cs</strong>. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Newtonsoft.Json.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.Helpers</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIHelper</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">CreateWorkspaceAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceName</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.CreateWorkspaceAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceName, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetWorkspaceIdsAsync</span>()
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.GetWorkspaceIdsAsync(Common.PowerBIConstants.WorkspaceCollectionName, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetReportIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.GetReportIdsAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetDatasetIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.GetDatasetIdsAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">UpdateConnectionCredentialsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.UpdateConnectionCredentialsAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, datasetId, Common.PowerBIConstants.AccessKey, Common.PowerBIConstants.DatasetUserName, Common.PowerBIConstants.DatasetPassword);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteReportAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.DeleteReportAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, reportId, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteDatasetAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.DeleteDatasetAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, datasetId, Common.PowerBIConstants.AccessKey);
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ImportPbixAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetName</span>, <span class="pl-k">byte</span>[] <span class="pl-smi">file</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IPowerBIService&gt;();
            <span class="pl-k">return</span> <span class="pl-k">await</span> service.ImportPbixAsync(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, datasetName, file, Common.PowerBIConstants.AccessKey);
        }
    }
}</pre></div>
<p>Unlike most code in a Xamarin Forms solution, Power BI Embedded code is platform-specific and cannot be shared across platforms. The <code>PowerBIHelper</code> class you just added contains methods that are called from shared code, but that delegate to methods in platform-specific code.</p>
</li>
<li>
<p>Now it's time write the platform-specific code. Begin by right-clicking the <strong>TwitterBI.Android</strong> project and using the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>PowerBIService.cs</strong> to the project. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;

<span class="pl-k">using</span> <span class="pl-en">Android.App</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Content</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.OS</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Runtime</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Views</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Widget</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Rest</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.Droid.DependencyServices</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;

[assembly: Xamarin.Forms.Dependency(typeof(PowerBIService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.Droid.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIService</span> : <span class="pl-en">IPowerBIService</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteDatasetAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Datasets.DeleteDatasetByIdAsync(workspaceCollectionName, workspaceId, datasetId);
                }
            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteReportAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Reports.DeleteReportAsync(
                            workspaceCollectionName,
                            workspaceId,
                            reportId);
                }

            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">CreateWorkspaceAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">string</span> <span class="pl-en">workspaceId</span> = <span class="pl-c1">null</span>;

            <span class="pl-en">CreateWorkspaceRequest</span> <span class="pl-en">request</span> = <span class="pl-c1">null</span>;
            <span class="pl-k">if</span> (!<span class="pl-k">string</span>.IsNullOrEmpty(workspaceName))
            {
                request = <span class="pl-k">new</span> <span class="pl-en">CreateWorkspaceRequest</span>(<span class="pl-en">workspaceName</span>);
            }

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">workspace </span>= <span class="pl-k">await</span> client.Workspaces.PostWorkspaceAsync(workspaceCollectionName, request);

                workspaceId = workspace.WorkspaceId;
            }

            <span class="pl-k">return</span> workspaceId;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetWorkspaceIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Workspaces.GetWorkspacesByCollectionNameAsync(workspaceCollectionName);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.WorkspaceId).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetDatasetIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Datasets.GetDatasetsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetReportIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Reports.GetReportsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">UpdateConnectionCredentialsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>, <span class="pl-k">string</span> <span class="pl-smi">username</span>, <span class="pl-k">string</span> <span class="pl-smi">password</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">var</span> <span class="pl-en">datasources </span>= <span class="pl-k">await</span> client.Datasets.GetGatewayDatasourcesAsync(workspaceCollectionName, workspaceId, datasetId);

                    <span class="pl-k">var</span> <span class="pl-en">delta </span>= <span class="pl-k">new</span> <span class="pl-en">GatewayDatasource</span>
                    {
                        CredentialType = <span class="pl-s"><span class="pl-pds">"</span>Basic<span class="pl-pds">"</span></span>,
                        BasicCredentials = <span class="pl-k">new</span> <span class="pl-en">BasicCredentials</span>
                        {
                            Username = username,
                            Password = password
                        }
                    };

                    <span class="pl-k">await</span> client.Gateways.PatchDatasourceAsync(workspaceCollectionName, workspaceId, datasources.Value[<span class="pl-c1">0</span>].GatewayId, datasources.Value[<span class="pl-c1">0</span>].Id, delta);
                    successful = <span class="pl-c1">true</span>; ;
                }
            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ImportPbixAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetName</span>, <span class="pl-k">byte</span>[] <span class="pl-smi">file</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-en">MemoryStream</span> <span class="pl-en">ms</span> = <span class="pl-k">new</span> <span class="pl-en">MemoryStream</span>(<span class="pl-en">file</span>);

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">fileStream </span>= ms)
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-c">// Set request timeout to support uploading large PBIX files</span>
                    client.HttpClient.Timeout = TimeSpan.FromMinutes(<span class="pl-c1">60</span>);
                    client.HttpClient.DefaultRequestHeaders.Add(<span class="pl-s"><span class="pl-pds">"</span>ActivityId<span class="pl-pds">"</span></span>, Guid.NewGuid().ToString());

                    <span class="pl-c">// Import PBIX file from the file stream</span>
                    <span class="pl-k">var</span> <span class="pl-en">import </span>= <span class="pl-k">await</span> client.Imports.PostImportWithFileAsync(workspaceCollectionName, workspaceId, fileStream, datasetName);

                    <span class="pl-c">// Example of polling the import to check when the import has succeeded.</span>
                    <span class="pl-k">while</span> (import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Succeeded<span class="pl-pds">"</span></span> &amp;&amp; import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Failed<span class="pl-pds">"</span></span>)
                    {
                        import = <span class="pl-k">await</span> client.Imports.GetImportByIdAsync(workspaceCollectionName, workspaceId, import.Id);

                        <span class="pl-k">await</span> Task.Delay(<span class="pl-c1">1000</span>);
                    }

                    successful = <span class="pl-c1">true</span>;
                }
            }

            <span class="pl-k">return</span> successful;
        }


        <span class="pl-k">private</span> <span class="pl-en">PowerBIClient</span> <span class="pl-en">CreateClient</span>(<span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= <span class="pl-k">new</span> <span class="pl-en">TokenCredentials</span>(accessKey, <span class="pl-s"><span class="pl-pds">"</span>AppKey<span class="pl-pds">"</span></span>);
            <span class="pl-k">var</span> <span class="pl-en">client </span>= <span class="pl-k">new</span> <span class="pl-en">PowerBIClient</span>(<span class="pl-en">credentials</span>);
            client.BaseUri = <span class="pl-k">new</span> <span class="pl-en">Uri</span>(<span class="pl-s"><span class="pl-pds">"</span>https://api.powerbi.com<span class="pl-pds">"</span></span>);

            <span class="pl-k">return</span> client;
        }
    }
}</pre></div>
</li>
<li>
<p>Right-click the <strong>TwitterBI.iOS</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>PowerBIService.cs</strong> to the project. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;

<span class="pl-k">using</span> <span class="pl-en">Foundation</span>;
<span class="pl-k">using</span> <span class="pl-en">UIKit</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Rest</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.iOS.DependencyServices</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading</span>;

[assembly: Xamarin.Forms.Dependency(typeof(PowerBIService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.iOS.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIService</span> : <span class="pl-en">IPowerBIService</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteDatasetAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Datasets.DeleteDatasetByIdAsync(workspaceCollectionName, workspaceId, datasetId);
                }
            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteReportAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Reports.DeleteReportAsync(
                            workspaceCollectionName,
                            workspaceId,
                            reportId);
                }

            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">CreateWorkspaceAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">string</span> <span class="pl-en">workspaceId</span> = <span class="pl-c1">null</span>;

            <span class="pl-en">CreateWorkspaceRequest</span> <span class="pl-en">request</span> = <span class="pl-c1">null</span>;
            <span class="pl-k">if</span> (!<span class="pl-k">string</span>.IsNullOrEmpty(workspaceName))
            {
                request = <span class="pl-k">new</span> <span class="pl-en">CreateWorkspaceRequest</span>(<span class="pl-en">workspaceName</span>);
            }

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">workspace </span>= <span class="pl-k">await</span> client.Workspaces.PostWorkspaceAsync(workspaceCollectionName, request);

                workspaceId = workspace.WorkspaceId;
            }

            <span class="pl-k">return</span> workspaceId;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetWorkspaceIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Workspaces.GetWorkspacesByCollectionNameAsync(workspaceCollectionName);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.WorkspaceId).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetDatasetIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Datasets.GetDatasetsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetReportIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Reports.GetReportsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">UpdateConnectionCredentialsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>, <span class="pl-k">string</span> <span class="pl-smi">username</span>, <span class="pl-k">string</span> <span class="pl-smi">password</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">var</span> <span class="pl-en">datasources </span>= <span class="pl-k">await</span> client.Datasets.GetGatewayDatasourcesAsync(workspaceCollectionName, workspaceId, datasetId);

                    <span class="pl-k">var</span> <span class="pl-en">delta </span>= <span class="pl-k">new</span> <span class="pl-en">GatewayDatasource</span>
                    {
                        CredentialType = <span class="pl-s"><span class="pl-pds">"</span>Basic<span class="pl-pds">"</span></span>,
                        BasicCredentials = <span class="pl-k">new</span> <span class="pl-en">BasicCredentials</span>
                        {
                            Username = username,
                            Password = password
                        }
                    };

                    <span class="pl-k">await</span> client.Gateways.PatchDatasourceAsync(workspaceCollectionName, workspaceId, datasources.Value[<span class="pl-c1">0</span>].GatewayId, datasources.Value[<span class="pl-c1">0</span>].Id, delta);
                    successful = <span class="pl-c1">true</span>;
                }
            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ImportPbixAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetName</span>, <span class="pl-k">byte</span>[] <span class="pl-smi">file</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-en">MemoryStream</span> <span class="pl-en">ms</span> = <span class="pl-k">new</span> <span class="pl-en">MemoryStream</span>(<span class="pl-en">file</span>);

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">fileStream </span>= ms)
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-c">// Set request timeout to support uploading large PBIX files</span>
                    client.HttpClient.Timeout = TimeSpan.FromMinutes(<span class="pl-c1">60</span>);
                    client.HttpClient.DefaultRequestHeaders.Add(<span class="pl-s"><span class="pl-pds">"</span>ActivityId<span class="pl-pds">"</span></span>, Guid.NewGuid().ToString());

                    <span class="pl-c">// Import PBIX file from the file stream</span>
                    <span class="pl-k">var</span> <span class="pl-en">import </span>= <span class="pl-k">await</span> client.Imports.PostImportWithFileAsync(workspaceCollectionName, workspaceId, fileStream, datasetName);

                    <span class="pl-c">// Example of polling the import to check when the import has succeeded.</span>
                    <span class="pl-k">while</span> (import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Succeeded<span class="pl-pds">"</span></span> &amp;&amp; import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Failed<span class="pl-pds">"</span></span>)
                    {
                        import = <span class="pl-k">await</span> client.Imports.GetImportByIdAsync(workspaceCollectionName, workspaceId, import.Id);

                        <span class="pl-k">await</span> Task.Delay(<span class="pl-c1">1000</span>);
                    }

                    successful = <span class="pl-c1">true</span>;
                }
            }

            <span class="pl-k">return</span> successful;
        }


        <span class="pl-k">private</span> <span class="pl-en">PowerBIClient</span> <span class="pl-en">CreateClient</span>(<span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= <span class="pl-k">new</span> <span class="pl-en">TokenCredentials</span>(accessKey, <span class="pl-s"><span class="pl-pds">"</span>AppKey<span class="pl-pds">"</span></span>);
            <span class="pl-k">var</span> <span class="pl-en">client </span>= <span class="pl-k">new</span> <span class="pl-en">PowerBIClient</span>(<span class="pl-en">credentials</span>);
            client.BaseUri = <span class="pl-k">new</span> <span class="pl-en">Uri</span>(<span class="pl-s"><span class="pl-pds">"</span>https://api.powerbi.com<span class="pl-pds">"</span></span>);

            <span class="pl-k">return</span> client;
        }
    }
}</pre></div>
</li>
<li>
<p>Right-click the <strong>TwitterBI.UWP (Universal Windows)</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>PowerBIService.cs</strong> to the project. Replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Api.V1.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">Microsoft.Rest</span>;
<span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.UWP.DependencyServices</span>;

[assembly: Xamarin.Forms.Dependency(typeof(PowerBIService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.UWP.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIService</span> : <span class="pl-en">IPowerBIService</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteDatasetAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {

            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Datasets.DeleteDatasetByIdAsync(workspaceCollectionName, workspaceId, datasetId);
                }
            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">DeleteReportAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">await</span> client.Reports.DeleteReportAsync(
                            workspaceCollectionName,
                            workspaceId,
                            reportId);
                }

            }
            <span class="pl-k">catch</span> { }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">CreateWorkspaceAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">string</span> <span class="pl-en">workspaceId</span> = <span class="pl-c1">null</span>;

            <span class="pl-en">CreateWorkspaceRequest</span> <span class="pl-en">request</span> = <span class="pl-c1">null</span>;
            <span class="pl-k">if</span> (!<span class="pl-k">string</span>.IsNullOrEmpty(workspaceName))
            {
                request = <span class="pl-k">new</span> <span class="pl-en">CreateWorkspaceRequest</span>(<span class="pl-en">workspaceName</span>);
            }

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">workspace </span>= <span class="pl-k">await</span> client.Workspaces.PostWorkspaceAsync(workspaceCollectionName, request);

                workspaceId = workspace.WorkspaceId;
            }

            <span class="pl-k">return</span> workspaceId;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetWorkspaceIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Workspaces.GetWorkspacesByCollectionNameAsync(workspaceCollectionName);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.WorkspaceId).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetDatasetIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Datasets.GetDatasetsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-en">List</span>&lt;<span class="pl-k">string</span>&gt;&gt; <span class="pl-en">GetReportIdsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
            {
                <span class="pl-k">var</span> <span class="pl-en">response </span>= <span class="pl-k">await</span> client.Reports.GetReportsAsync(workspaceCollectionName, workspaceId);
                <span class="pl-k">return</span> response.Value.Select(s =&gt; s.Id).ToList();
            }
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">UpdateConnectionCredentialsAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetId</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>, <span class="pl-k">string</span> <span class="pl-smi">username</span>, <span class="pl-k">string</span> <span class="pl-smi">password</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-k">try</span>
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-k">var</span> <span class="pl-en">datasources </span>= <span class="pl-k">await</span> client.Datasets.GetGatewayDatasourcesAsync(workspaceCollectionName, workspaceId, datasetId);

                    <span class="pl-k">var</span> <span class="pl-en">delta </span>= <span class="pl-k">new</span> <span class="pl-en">GatewayDatasource</span>
                    {
                        CredentialType = <span class="pl-s"><span class="pl-pds">"</span>Basic<span class="pl-pds">"</span></span>,
                        BasicCredentials = <span class="pl-k">new</span> <span class="pl-en">BasicCredentials</span>
                        {
                            Username = username,
                            Password = password
                        }
                    };

                    <span class="pl-k">await</span> client.Gateways.PatchDatasourceAsync(workspaceCollectionName, workspaceId, datasources.Value[<span class="pl-c1">0</span>].GatewayId, datasources.Value[<span class="pl-c1">0</span>].Id, delta);
                    successful = <span class="pl-c1">true</span>;
                }
            }
            <span class="pl-k">catch</span> (Exception ex)
            {
            }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ImportPbixAsync</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceCollectionName</span>, <span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">datasetName</span>, <span class="pl-k">byte</span>[] <span class="pl-smi">file</span>, <span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-c1">false</span>;

            <span class="pl-en">MemoryStream</span> <span class="pl-en">ms</span> = <span class="pl-k">new</span> <span class="pl-en">MemoryStream</span>(<span class="pl-en">file</span>);

            <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">fileStream </span>= ms)
            {
                <span class="pl-k">using</span> (<span class="pl-k">var</span> <span class="pl-en">client </span>= CreateClient(accessKey))
                {
                    <span class="pl-c">// Set request timeout to support uploading large PBIX files</span>
                    client.HttpClient.Timeout = TimeSpan.FromMinutes(<span class="pl-c1">60</span>);
                    client.HttpClient.DefaultRequestHeaders.Add(<span class="pl-s"><span class="pl-pds">"</span>ActivityId<span class="pl-pds">"</span></span>, Guid.NewGuid().ToString());

                    <span class="pl-c">// Import PBIX file from the file stream</span>
                    <span class="pl-k">var</span> <span class="pl-en">import </span>= <span class="pl-k">await</span> client.Imports.PostImportWithFileAsync(workspaceCollectionName, workspaceId, fileStream, datasetName);

                    <span class="pl-c">// Example of polling the import to check when the import has succeeded.</span>
                    <span class="pl-k">while</span> (import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Succeeded<span class="pl-pds">"</span></span> &amp;&amp; import.ImportState != <span class="pl-s"><span class="pl-pds">"</span>Failed<span class="pl-pds">"</span></span>)
                    {
                        import = <span class="pl-k">await</span> client.Imports.GetImportByIdAsync(workspaceCollectionName, workspaceId, import.Id);

                        <span class="pl-k">await</span> Task.Delay(<span class="pl-c1">1000</span>);
                    }

                    successful = <span class="pl-c1">true</span>;
                }
            }

            <span class="pl-k">return</span> successful;
        }

        <span class="pl-k">private</span> <span class="pl-en">PowerBIClient</span> <span class="pl-en">CreateClient</span>(<span class="pl-k">string</span> <span class="pl-smi">accessKey</span>)
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= <span class="pl-k">new</span> <span class="pl-en">TokenCredentials</span>(accessKey, <span class="pl-s"><span class="pl-pds">"</span>AppKey<span class="pl-pds">"</span></span>);
            <span class="pl-k">var</span> <span class="pl-en">client </span>= <span class="pl-k">new</span> <span class="pl-en">PowerBIClient</span>(<span class="pl-en">credentials</span>);
            client.BaseUri = <span class="pl-k">new</span> <span class="pl-en">Uri</span>(<span class="pl-s"><span class="pl-pds">"</span>https://api.powerbi.com<span class="pl-pds">"</span></span>);

            <span class="pl-k">return</span> client;
        }
    }
}</pre></div>
<p>Notice that except for the <code>using</code> statements and <code>namespace</code> definitions, the <code>PowerBIService</code> class in each project looks exactly the same. The classes that it relies on, however, are platform-specific, and were added when you installed <strong>Microsoft.PowerBI.Api</strong> into the iOS, Android, and Windows projects.</p>
</li>
<li>
<p>Open <strong>MainViewModel.cs</strong> in the <strong>TwitterBI (Portable)</strong> project and replace its contents with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.ObjectModel</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.Common</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">MainViewModel</span> : <span class="pl-en">ObservableBase</span>
    {
        <span class="pl-k">public</span> <span class="pl-en">MainViewModel</span>()
        {
            <span class="pl-c1">this</span>.WorkspaceIds = <span class="pl-k">new</span> <span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt;();
            <span class="pl-c1">this</span>.DatasetIds = <span class="pl-k">new</span> <span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt;();
            <span class="pl-c1">this</span>.ReportIds = <span class="pl-k">new</span> <span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt;();
        }
 
        <span class="pl-k">private </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">_workspaceIds</span>;
        <span class="pl-k">public </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">WorkspaceIds</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._workspaceIds; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._workspaceIds, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">_reportIds</span>;
        <span class="pl-k">public </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">ReportIds</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._reportIds; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._reportIds, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">_datasetIds</span>;
        <span class="pl-k">public </span><span class="pl-en">ObservableCollection</span>&lt;<span class="pl-k">string</span>&gt; <span class="pl-en">DatasetIds</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._datasetIds; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._datasetIds, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">string</span> <span class="pl-en">_currentWorkspaceId</span>;
        <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CurrentWorkspaceId</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._currentWorkspaceId; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._currentWorkspaceId, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">string</span> <span class="pl-en">_currentReportId</span>;
        <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CurrentReportId</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._currentReportId; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._currentReportId, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">string</span> <span class="pl-en">_currentDatasetId</span>;
        <span class="pl-k">public </span><span class="pl-k">string</span> <span class="pl-en">CurrentDatasetId</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._currentDatasetId; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._currentDatasetId, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">bool</span> <span class="pl-en">_needsWorkspaceCreated</span>;
        <span class="pl-k">public </span><span class="pl-k">bool</span> <span class="pl-en">NeedsWorkspaceCreated</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._needsWorkspaceCreated; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._needsWorkspaceCreated, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">bool</span> <span class="pl-en">_needsReportCreated</span>;
        <span class="pl-k">public </span><span class="pl-k">bool</span> <span class="pl-en">NeedsReportCreated</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._needsReportCreated; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._needsReportCreated, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">bool</span> <span class="pl-en">_isDatasetCreated</span>;
        <span class="pl-k">public </span><span class="pl-k">bool</span> <span class="pl-en">IsDatasetCreated</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._isDatasetCreated; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._isDatasetCreated, <span class="pl-k">value</span>); }
        }

        <span class="pl-k">private </span><span class="pl-k">bool</span> <span class="pl-en">_isBusy</span>;
        <span class="pl-k">public </span><span class="pl-k">bool</span> <span class="pl-en">IsBusy</span>
        {
            <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._isBusy; }
            <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._isBusy, <span class="pl-k">value</span>); }
        }
        
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">ClearWorkspaceAsync</span>()
        {
            <span class="pl-c1">this</span>.IsBusy = <span class="pl-c1">true</span>;
            <span class="pl-k">await</span> InitializeWorkspaceAsync();

            <span class="pl-k">foreach</span> (var reportId <span class="pl-k">in</span> <span class="pl-c1">this</span>.ReportIds)
            {
                <span class="pl-k">await</span> Helpers.PowerBIHelper.DeleteReportAsync(<span class="pl-c1">this</span>.CurrentWorkspaceId, reportId);
            }

            <span class="pl-k">foreach</span> (var datasetId <span class="pl-k">in</span> <span class="pl-c1">this</span>.DatasetIds)
            {
                <span class="pl-k">await</span> Helpers.PowerBIHelper.DeleteDatasetAsync(<span class="pl-c1">this</span>.CurrentWorkspaceId, datasetId);
            }

            <span class="pl-k">await</span> InitializeWorkspaceAsync();
            <span class="pl-c1">this</span>.IsBusy = <span class="pl-c1">false</span>;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-en">Task</span> <span class="pl-en">InitializeWorkspaceAsync</span>()
        {
            <span class="pl-c1">this</span>.IsBusy = <span class="pl-c1">true</span>;
            <span class="pl-k">var</span> <span class="pl-en">workspaceIds </span>= <span class="pl-k">await</span> Helpers.PowerBIHelper.GetWorkspaceIdsAsync();

            <span class="pl-c1">this</span>.WorkspaceIds.Clear();
            <span class="pl-k">foreach</span> (var workspaceId <span class="pl-k">in</span> workspaceIds)
            {
                <span class="pl-c1">this</span>.WorkspaceIds.Add(workspaceId);
            }
            <span class="pl-c1">this</span>.CurrentWorkspaceId = <span class="pl-c1">this</span>.WorkspaceIds.FirstOrDefault();
            <span class="pl-c1">this</span>.NeedsWorkspaceCreated = <span class="pl-c1">this</span>.CurrentWorkspaceId == <span class="pl-c1">null</span>;

            <span class="pl-k">if</span> (<span class="pl-c1">this</span>.CurrentWorkspaceId != <span class="pl-c1">null</span>)
            {
                <span class="pl-k">var</span> <span class="pl-en">reportIds </span>= <span class="pl-k">await</span> Helpers.PowerBIHelper.GetReportIdsAsync(<span class="pl-c1">this</span>.CurrentWorkspaceId);

                <span class="pl-c1">this</span>.ReportIds.Clear();
                <span class="pl-k">foreach</span> (var reportId <span class="pl-k">in</span> reportIds)
                {
                    <span class="pl-c1">this</span>.ReportIds.Add(reportId);
                }
                <span class="pl-c1">this</span>.CurrentReportId = <span class="pl-c1">this</span>.ReportIds.FirstOrDefault();
                <span class="pl-c1">this</span>.NeedsReportCreated = <span class="pl-c1">this</span>.CurrentWorkspaceId != <span class="pl-c1">null</span> &amp;&amp; <span class="pl-c1">this</span>.CurrentReportId == <span class="pl-c1">null</span>;

                <span class="pl-k">var</span> <span class="pl-en">datasetIds </span>= <span class="pl-k">await</span> Helpers.PowerBIHelper.GetDatasetIdsAsync(<span class="pl-c1">this</span>.CurrentWorkspaceId);
                <span class="pl-c1">this</span>.DatasetIds.Clear();

                <span class="pl-k">foreach</span> (var datasetId <span class="pl-k">in</span> datasetIds)
                {
                    <span class="pl-c1">this</span>.DatasetIds.Add(datasetId);
                }

                <span class="pl-c1">this</span>.CurrentDatasetId = <span class="pl-c1">this</span>.DatasetIds.FirstOrDefault();
                <span class="pl-c1">this</span>.IsDatasetCreated = <span class="pl-c1">this</span>.CurrentWorkspaceId != <span class="pl-c1">null</span> &amp;&amp; <span class="pl-c1">this</span>.CurrentReportId != <span class="pl-c1">null</span>;
            }

            <span class="pl-c1">this</span>.IsBusy = <span class="pl-c1">false</span>;
            <span class="pl-k">return</span>;
        }
    }
}</pre></div>
</li>
<li>
<p>Open <strong>MainPage.xaml</strong> in the <strong>TwitterBI (Portable)</strong> project and replace its contents with the following XAML:</p>
<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span> ?&gt;
&lt;<span class="pl-ent">ContentPage</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://xamarin.com/schemas/2014/forms<span class="pl-pds">"</span></span>
             <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">x</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.microsoft.com/winfx/2009/xaml<span class="pl-pds">"</span></span> <span class="pl-e">Title</span>=<span class="pl-s"><span class="pl-pds">"</span>Welcome to TwitterBI<span class="pl-pds">"</span></span>
             <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">local</span>=<span class="pl-s"><span class="pl-pds">"</span>clr-namespace:TwitterBI<span class="pl-pds">"</span></span>
             <span class="pl-e">x</span><span class="pl-e">:</span><span class="pl-e">Class</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBI.MainPage<span class="pl-pds">"</span></span>&gt;

    &lt;<span class="pl-ent">ScrollView</span> <span class="pl-e">Margin</span>=<span class="pl-s"><span class="pl-pds">"</span>40,30<span class="pl-pds">"</span></span>&gt;
        &lt;<span class="pl-ent">Grid</span>&gt;
            &lt;<span class="pl-ent">StackLayout</span>&gt;
                &lt;<span class="pl-ent">Label</span> <span class="pl-e">Margin</span>=<span class="pl-s"><span class="pl-pds">"</span>0,10<span class="pl-pds">"</span></span> <span class="pl-e">Style</span>=<span class="pl-s"><span class="pl-pds">"</span>{DynamicResource TitleStyle}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>PowerBI Embedded<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">Label</span> <span class="pl-e">Style</span>=<span class="pl-s"><span class="pl-pds">"</span>{DynamicResource BodyStyle}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>To create a PowerBI Embedded Workspace, tap 'Create Workspace'.<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">Button</span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#F2C811<span class="pl-pds">"</span></span> <span class="pl-e">TextColor</span>=<span class="pl-s"><span class="pl-pds">"</span>Black<span class="pl-pds">"</span></span> <span class="pl-e">IsEnabled</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding NeedsWorkspaceCreated}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>Create Workspace<span class="pl-pds">"</span></span> <span class="pl-e">Clicked</span>=<span class="pl-s"><span class="pl-pds">"</span>OnCreateWorkspaceClicked<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">Label</span> <span class="pl-e">Style</span>=<span class="pl-s"><span class="pl-pds">"</span>{DynamicResource BodyStyle}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>To provision a report and connect a datasource, tap 'Import Report Definition'.<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">Button</span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#F2C811<span class="pl-pds">"</span></span> <span class="pl-e">TextColor</span>=<span class="pl-s"><span class="pl-pds">"</span>Black<span class="pl-pds">"</span></span> <span class="pl-e">IsEnabled</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding NeedsReportCreated}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>Import Report Definition<span class="pl-pds">"</span></span> <span class="pl-e">Clicked</span>=<span class="pl-s"><span class="pl-pds">"</span>OnImportReportClicked<span class="pl-pds">"</span></span>/&gt;
                &lt;<span class="pl-ent">Label</span> <span class="pl-e">FontAttributes</span>=<span class="pl-s"><span class="pl-pds">"</span>Bold<span class="pl-pds">"</span></span> <span class="pl-e">IsVisible</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsDatasetCreated}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>The Twitter Activity report is available.<span class="pl-pds">"</span></span> /&gt;
            &lt;/<span class="pl-ent">StackLayout</span>&gt;
            &lt;<span class="pl-ent">ActivityIndicator</span> <span class="pl-e">WidthRequest</span>=<span class="pl-s"><span class="pl-pds">"</span>80<span class="pl-pds">"</span></span> <span class="pl-e">HeightRequest</span>=<span class="pl-s"><span class="pl-pds">"</span>80<span class="pl-pds">"</span></span> <span class="pl-e">VerticalOptions</span>=<span class="pl-s"><span class="pl-pds">"</span>Center<span class="pl-pds">"</span></span> <span class="pl-e">HorizontalOptions</span>=<span class="pl-s"><span class="pl-pds">"</span>Center<span class="pl-pds">"</span></span> <span class="pl-e">IsEnabled</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsBusy}<span class="pl-pds">"</span></span> <span class="pl-e">IsVisible</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsBusy}<span class="pl-pds">"</span></span> <span class="pl-e">IsRunning</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsBusy}<span class="pl-pds">"</span></span> <span class="pl-e">Color</span>=<span class="pl-s"><span class="pl-pds">"</span>#F2C811<span class="pl-pds">"</span></span>/&gt;
        &lt;/<span class="pl-ent">Grid</span>&gt;
    &lt;/<span class="pl-ent">ScrollView</span>&gt;
&lt;/<span class="pl-ent">ContentPage</span>&gt;</pre></div>
</li>
<li>
<p>Open <strong>MainPage.xaml.cs</strong> in the <strong>TwitterBI (Portable)</strong> project and replace its contents with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.IO</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Net.Http</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Xamarin.Forms</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI</span>
{
    <span class="pl-k">public</span> <span class="pl-k">partial</span> <span class="pl-k">class</span> <span class="pl-en">MainPage</span> : <span class="pl-en">ContentPage</span>
    {
        <span class="pl-k">public</span> <span class="pl-en">MainPage</span>()
        {
            InitializeComponent();
        }

        <span class="pl-k">protected</span> <span class="pl-k">async</span> <span class="pl-k">override</span> <span class="pl-k">void</span> <span class="pl-en">OnAppearing</span>()
        {
            <span class="pl-c1">base</span>.OnAppearing();
            <span class="pl-k">if</span> (App.ViewModel == <span class="pl-c1">null</span>) App.ViewModel = <span class="pl-k">new</span> <span class="pl-en">MainViewModel</span>();
            <span class="pl-c1">this</span>.BindingContext = App.ViewModel;
            <span class="pl-k">await</span> App.ViewModel.InitializeWorkspaceAsync();               
        }

        <span class="pl-k">private</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">OnCreateWorkspaceClicked</span>(<span class="pl-k">object</span> <span class="pl-smi">sender</span>, <span class="pl-en">EventArgs</span> <span class="pl-smi">e</span>)
        {
            <span class="pl-k">string</span> <span class="pl-en">workspaceId</span> = <span class="pl-k">await</span> Helpers.PowerBIHelper.CreateWorkspaceAsync(Common.PowerBIConstants.WorkspaceName);
            <span class="pl-k">await</span> App.ViewModel.InitializeWorkspaceAsync();
        }

        <span class="pl-k">private</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">OnImportReportClicked</span>(<span class="pl-k">object</span> <span class="pl-smi">sender</span>, <span class="pl-en">EventArgs</span> <span class="pl-smi">e</span>)
        {
            <span class="pl-en">HttpClient</span> <span class="pl-en">client</span> = <span class="pl-k">new</span> <span class="pl-en">HttpClient</span>();
            <span class="pl-k">var</span> <span class="pl-en">bytes </span>= <span class="pl-k">await</span> client.GetByteArrayAsync(Common.PowerBIConstants.ReportLocation);
            <span class="pl-k">bool</span> <span class="pl-en">successful</span> = <span class="pl-k">await</span> Helpers.PowerBIHelper.ImportPbixAsync(App.ViewModel.CurrentWorkspaceId, Common.PowerBIConstants.WorkspaceName, bytes);
            <span class="pl-k">await</span> App.ViewModel.InitializeWorkspaceAsync();

            <span class="pl-k">if</span> (<span class="pl-en">successful</span>)
            {
                <span class="pl-k">await</span> Helpers.PowerBIHelper.UpdateConnectionCredentialsAsync(App.ViewModel.CurrentWorkspaceId, App.ViewModel.CurrentDatasetId);
            }
        }
    }
}</pre></div>
<p>Notice the button-click handlers that call <code>CreateWorkspaceAsync</code> and <code>ImportPbixAsync</code>. This is the code that creates a Power BI Embedded workspace and imports a Power BI Embedded report, and that is <em>crucial to every app that hosts Power BI Embedded</em>.</p>
</li>
<li>
<p>Make the Android project the startup project and launch it. Once the app is running, click the <strong>Create Workspace</strong> button to create a Power BI Embedded workspace and add it to the workspace collection that you created in the Azure Portal.</p>
<p><a href="Images/app-click-create-workspace.png" target="_blank"><img src="Images/app-click-create-workspace.png" alt="Creating a Power BI Embedded workspace" style="max-width:100%;"></a></p>
<p><em>Creating a Power BI Embedded workspace</em></p>
</li>
<li>
<p>Next,  click <strong>Import Report Definition</strong> to import a PBIX file containing a report definition The PBIX file was created ahead of time so you wouldn't have to create it yourself.</p>
<blockquote>
<p>If you'd like to learn how to create reports, see <a href="https://github.com/Microsoft/TechnicalCommunityContent/tree/master/Advanced%20Analytics/Power%20BI/Session%202%20-%20Hands%20On">Using Microsoft Power BI to Explore and Visualize Data</a>. One created, reports can be saved as PBIX files and then imported into Power BI Embedded. For instructions on how to save a report as a PBIX file, see <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-service-export-to-pbix/#download-the-report-as-a-pbix">https://powerbi.microsoft.com/en-us/documentation/powerbi-service-export-to-pbix/#download-the-report-as-a-pbix</a>.</p>
</blockquote>
<p><a href="Images/app-click-import-definition.png" target="_blank"><img src="Images/app-click-import-definition.png" alt="Importing a Power BI Embedded report definition" style="max-width:100%;"></a></p>
<p><em>Importing a Power BI Embedded report definition</em></p>
</li>
</ol>
<p>Now it's time to start populating the dataset that was created when you imported the report definition. This is where things start to get fun, since you'll be viewing real-time Twitter activity in your Power BI Embedded report (and therefore in the app).</p>
<p><a name="Exercise4"></a></p>
<h2>Exercise 4: Register a Twitter app</h2>
<p>In order to access Twitter streams programmatically, you need an access token that allows Twitter to authenticate calls from your app. And in order to get an access token, you must have a Twitter account. If you don't have a Twitter account, go to <a href="http://www.twitter.com">http://www.twitter.com</a> and create one now.</p>
<ol>
<li>
<p>Go to <a href="https://dev.twitter.com/">https://dev.twitter.com/</a> in your browser and click <strong>My Apps</strong> in the menu at the top of the page.</p>
<p><a href="Images/twitter-click-my-apps.png" target="_blank"><img src="Images/twitter-click-my-apps.png" alt="Viewing My Apps in the Twitter developer portal" style="max-width:100%;"></a></p>
<p><em>Viewing My Apps in the Twitter developer portal</em></p>
</li>
<li>
<p>Click <strong>Create New App</strong>. If you are asked to sign in, do so with your Twitter credentials.</p>
<p><a href="Images/twitter-click-create-app.png" target="_blank"><img src="Images/twitter-click-create-app.png" alt="Creating a new Twitter app" style="max-width:100%;"></a></p>
<p><em>Creating a new Twitter app</em></p>
</li>
<li>
<p>Fill in the "Create an application" form as shown below. The application name has to be unique, so you won't be able to use "Twitter BI" (although you could use something like "Twitter BI 093059"). Then click <strong>Create your Twitter Application</strong>.</p>
<p><a href="Images/twitter-fill-out-form.png" target="_blank"><img src="Images/twitter-fill-out-form.png" alt="Creating a Twitter application" style="max-width:100%;"></a></p>
<p><em>Creating a Twitter application</em></p>
</li>
<li>
<p>Click <strong>Keys and Access Tokens</strong>.</p>
<p><a href="Images/twitter-select-keys.png" target="_blank"><img src="Images/twitter-select-keys.png" alt="Accessing keys and access tokens" style="max-width:100%;"></a></p>
<p><em>Accessing keys and access tokens</em></p>
</li>
<li>
<p>Scroll to the bottom of the page and click <strong>Create my access token</strong>.</p>
<p><a href="Images/twitter-click-create-tokens.png" target="_blank"><img src="Images/twitter-click-create-tokens.png" alt="Creating an access token" style="max-width:100%;"></a></p>
<p><em>Creating an access token</em></p>
</li>
</ol>
<p>For convenience, leave this page open in your browser because you will need several of the values shown on the page in the next exercise.</p>
<p><a name="Exercise5"></a></p>
<h2>Exercise 5: Write code to track Twitter activity</h2>
<p>In this exercise, you will write code that uses <strong>TweetinviAPI</strong>, a popular Twitter API library, to monitor tweets, and that transmits the latitudes and longitudes that the tweets originate from to a back-end dataset used by the Power BI report that you imported in <a href="#Exercise3">Exercise 3</a>.</p>
<ol>
<li>
<p>In Visual Studio's Solution Explorer, right-click the <strong>TwitterBI</strong> solution and select <strong>Manage NuGet Packages for Solution...</strong>. Search for "tweetenvi," and then install <strong>TweetinviAPI</strong> in all four projects. If prompted to review changes, click <strong>OK</strong>.</p>
<p><a href="Images/nuget-tweetinvi.png" target="_blank"><img src="Images/nuget-tweetinvi.png" alt="Installing TweetinviAPI" style="max-width:100%;"></a></p>
<p><em>Installing TweetinviAPI</em></p>
</li>
<li>
<p>Open <strong>CoreConstants.cs</strong> in the "Common" folder of the <strong>TwitterBI (Portable)</strong> project and add the following class definition:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">TwitterConstants</span>
{
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">ConsumerKey</span> = <span class="pl-s"><span class="pl-pds">"</span>TWITTER_CONSUMER_KEY<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">ConsumerSecret</span> = <span class="pl-s"><span class="pl-pds">"</span>TWITTER_CONSUMER_SECRET<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">AccessToken</span> = <span class="pl-s"><span class="pl-pds">"</span>TWITTER_ACCESS_TOKEN<span class="pl-pds">"</span></span>;
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">AccessSecret</span> = <span class="pl-s"><span class="pl-pds">"</span>TWITTER_ACCESS_TOKEN_SECRET<span class="pl-pds">"</span></span>;

    <span class="pl-c">// THIS LATITUDE/LONGITUDE RECTANGLE DENOTES THE GENERAL AREA OF TEXAS, UNITED STATES</span>
    <span class="pl-k">public static </span><span class="pl-k">double</span> <span class="pl-en">StartingLatitude</span> = <span class="pl-c1">36.221413</span>;
    <span class="pl-k">public static </span><span class="pl-k">double</span> <span class="pl-en">StartingLongitude</span> = -<span class="pl-c1">106.600440</span>;
    <span class="pl-k">public static </span><span class="pl-k">double</span> <span class="pl-en">EndingLatitude</span> = <span class="pl-c1">30.386337</span>;
    <span class="pl-k">public static </span><span class="pl-k">double</span> <span class="pl-en">EndingLongitude</span> = -<span class="pl-c1">93.592628</span>;

    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">ActivityBaseUrl</span> = <span class="pl-s"><span class="pl-pds">"</span>https://traininglabservices.azurewebsites.net/api/TwitterActivity<span class="pl-pds">"</span></span>;
}	</pre></div>
</li>
<li>
<p>Replace <em>TWITTER_CONSUMER_KEY</em> in the code you just added with the <strong>Consumer Key (API Key)</strong> shown on the Twitter developer page open in your browser.</p>
</li>
<li>
<p>Replace <em>TWITTER_CONSUMER_SECRET</em> with the <strong>Consumer Secret (API Key)</strong> shown in the browser.</p>
</li>
<li>
<p>Replace <em>TWITTER_ACCESS_TOKEN</em> with the <strong>Access Token</strong> shown in the browser.</p>
</li>
<li>
<p>Replace <em>TWITTER_ACCESS_TOKEN_SECRET</em> with the <strong>Access Token Secret</strong> shown in the browser.</p>
</li>
<li>
<p>Open <strong>MainViewModel.cs</strong> in the <strong>TwitterBI (Portable)</strong> project and add the following properties and methods to the <code>MainViewModel</code> class:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> <span class="pl-k">bool</span> <span class="pl-en">_canStartStreaming</span>;
<span class="pl-k">public</span> <span class="pl-k">bool </span><span class="pl-en">CanStartStreaming</span>
{
    <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._canStartStreaming; }
    <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._canStartStreaming, <span class="pl-k">value</span>); }
}

<span class="pl-k">private</span> <span class="pl-k">string</span> <span class="pl-en">_startStreamingLabel</span>;
<span class="pl-k">public</span> <span class="pl-k">string </span><span class="pl-en">StartStreamingLabel</span>
{
    <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._startStreamingLabel; }
    <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._startStreamingLabel, <span class="pl-k">value</span>); }
}

<span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">ToggleStreamingLabel</span>()
{
    <span class="pl-c1">this</span>.StartStreamingLabel = (<span class="pl-c1">this</span>.CanStartStreaming) ? <span class="pl-s"><span class="pl-pds">"</span>Start Streaming<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>Stop Streaming<span class="pl-pds">"</span></span>;
}</pre></div>
</li>
<li>
<p>Add the following statements to the end of the <code>MainViewModel</code> constructor:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-c1">this</span>.<span class="pl-en">CanStartStreaming</span> = true;
ToggleStreamingLabel();</pre></div>
</li>
<li>
<p>Scroll down to the <code>InitializeWorkspaceAsync</code> method and insert the following line of code after the line that initializes <code>this.IsDatasetCreated</code>:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-c1">this</span>.<span class="pl-en">CanStartStreaming</span> = this.CurrentReportId != null;</pre></div>
</li>
<li>
<p>Open <strong>MainPage.xaml</strong> in the <strong>TwitterBI (Portable)</strong> project and insert the following XAML before the closing <code>&lt;/StackLayout&gt;</code> tag:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">Label</span> <span class="pl-e">Margin</span>=<span class="pl-s"><span class="pl-pds">"</span>0,10<span class="pl-pds">"</span></span> <span class="pl-e">Style</span>=<span class="pl-s"><span class="pl-pds">"</span>{DynamicResource TitleStyle}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>Twitter Streaming<span class="pl-pds">"</span></span>/&gt;
&lt;<span class="pl-ent">Label</span> <span class="pl-e">Style</span>=<span class="pl-s"><span class="pl-pds">"</span>{DynamicResource BodyStyle}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>To start streaming Twitter activity, tap 'Start Streaming'.<span class="pl-pds">"</span></span>/&gt;
&lt;<span class="pl-ent">Button</span> <span class="pl-e">IsVisible</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsDatasetCreated}<span class="pl-pds">"</span></span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#00ACED<span class="pl-pds">"</span></span> <span class="pl-e">TextColor</span>=<span class="pl-s"><span class="pl-pds">"</span>Black<span class="pl-pds">"</span></span> <span class="pl-e">IsEnabled</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding IsStreamingStopped}<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding StartStreamingLabel}<span class="pl-pds">"</span></span> <span class="pl-e">Clicked</span>=<span class="pl-s"><span class="pl-pds">"</span>OnStartStreamingClicked<span class="pl-pds">"</span></span>/&gt;</pre></div>
<p><a href="Images/vs-updated-mainpage.png" target="_blank"><img src="Images/vs-updated-mainpage.png" alt="Updating MainPage.xaml.cs" style="max-width:100%;"></a></p>
<p><em>Updating MainPage.xaml.cs</em></p>
</li>
<li>
<p>Open <strong>MainPage.xaml.cs</strong> in the <strong>TwitterBI (Portable)</strong> project and insert the following method after the <code>OnImportReportClicked</code> method:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">OnStartStreamingClicked</span>(<span class="pl-k">object</span> <span class="pl-smi">sender</span>, <span class="pl-en">EventArgs</span> <span class="pl-smi">e</span>)
{
    <span class="pl-k">if</span> (App.ViewModel.CanStartStreaming)
    {
        Helpers.StreamHelper.StartStreaming();
    }
    <span class="pl-k">else</span>
    {
        Helpers.StreamHelper.StopStreaming();
    }

    App.ViewModel.ToggleStreamingLabel();
}</pre></div>
</li>
<li>
<p>Right-click the "Interfaces" folder in the <strong>TwitterBI (Portable)</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>IStreamService.cs</strong>. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI</span>
{
    <span class="pl-k">public</span> <span class="pl-k">interface</span> <span class="pl-en">IStreamService</span>
    {
        <span class="pl-k">void</span> <span class="pl-en">StartStreaming</span>();
        <span class="pl-k">void</span> <span class="pl-en">StopStreaming</span>();
    }
}</pre></div>
</li>
<li>
<p>Right-click the "Helpers" folder and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>StreamHelper.cs</strong> to the folder. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Net.Http</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Models</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.Helpers</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">StreamHelper</span>
    {
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">AddTwitterActivityAsync</span>(<span class="pl-k">double</span> <span class="pl-smi">latitude</span>, <span class="pl-k">double</span> <span class="pl-smi">longitude</span>)
        {
            <span class="pl-en">HttpClient</span> <span class="pl-en">client</span> = <span class="pl-k">new</span> <span class="pl-en">HttpClient</span>();
            <span class="pl-en">HttpResponseMessage</span> <span class="pl-en">result</span> = <span class="pl-k">await</span> client.PostAsync(Common.TwitterConstants.ActivityBaseUrl + <span class="pl-pds">$"</span><span class="pl-s">?workspaceId=</span>{App.ViewModel.CurrentWorkspaceId}<span class="pl-s">&amp;latitude=</span>{latitude}<span class="pl-s">&amp;longitude=</span>{longitude}<span class="pl-pds">"</span>, <span class="pl-c1">null</span>);
            <span class="pl-k">return</span> result.IsSuccessStatusCode;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-en">Task</span>&lt;<span class="pl-k">bool</span>&gt; <span class="pl-en">ClearTwitterActivityAsync</span>()
        {
            <span class="pl-en">HttpClient</span> <span class="pl-en">client</span> = <span class="pl-k">new</span> <span class="pl-en">HttpClient</span>();
            <span class="pl-en">HttpResponseMessage</span> <span class="pl-en">result</span> = <span class="pl-k">await</span> client.GetAsync(Common.TwitterConstants.ActivityBaseUrl + <span class="pl-pds">$"</span><span class="pl-s">?workspaceId=</span>{App.ViewModel.CurrentWorkspaceId}<span class="pl-pds">"</span>);
            <span class="pl-k">return</span> result.IsSuccessStatusCode;
        }

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">StartStreaming</span>()
        {
            App.ViewModel.CanStartStreaming = <span class="pl-c1">false</span>;
            <span class="pl-k">await</span> ClearTwitterActivityAsync();
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IStreamService&gt;();
            service.StartStreaming();
        }

        <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">StopStreaming</span>()
        {
            App.ViewModel.CanStartStreaming = <span class="pl-c1">true</span>;
            <span class="pl-k">var</span> <span class="pl-en">service </span>= Xamarin.Forms.DependencyService.Get&lt;IStreamService&gt;();
            service.StopStreaming();
        }
    }
}</pre></div>
<blockquote>
<p>Just like Power BI Embedded code, <strong>TweetinviAPI</strong> code is platform-specific. The code you just added allows platform-specific code to be called from shared code.</p>
</blockquote>
</li>
<li>
<p>Right-click the <strong>TwitterBI.Android</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>StreamService.cs</strong>. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;

<span class="pl-k">using</span> <span class="pl-en">Android.App</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Content</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.OS</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Runtime</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Views</span>;
<span class="pl-k">using</span> <span class="pl-en">Android.Widget</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.Droid.DependencyServices</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Streaming</span>;

[assembly: Xamarin.Forms.Dependency(typeof(StreamService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.Droid.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">StreamService</span> : <span class="pl-en">IStreamService</span>
    {
        <span class="pl-k">public </span><span class="pl-en">IFilteredStream</span> <span class="pl-en">CurrentStream</span> = <span class="pl-c1">null</span>;

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">StartStreaming</span>()
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= Auth.CreateCredentials(Common.TwitterConstants.ConsumerKey, Common.TwitterConstants.ConsumerSecret, Common.TwitterConstants.AccessToken, Common.TwitterConstants.AccessSecret);

            <span class="pl-c1">this</span>.CurrentStream = Stream.CreateFilteredStream(credentials);

            <span class="pl-c1">this</span>.CurrentStream.StallWarnings = <span class="pl-c1">true</span>;
            <span class="pl-c1">this</span>.CurrentStream.FilterLevel = Tweetinvi.Streaming.Parameters.StreamFilterLevel.None;
            <span class="pl-c1">this</span>.CurrentStream.AddLocation(<span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.StartingLatitude, Common.TwitterConstants.StartingLongitude), <span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.EndingLatitude, Common.TwitterConstants.EndingLongitude));

            <span class="pl-c1">this</span>.CurrentStream.MatchingTweetReceived += (sender, args) =&gt;
            {
                <span class="pl-k">if</span> (args.Tweet.Coordinates != <span class="pl-c1">null</span>)
                {
                    AddActivityAsync(args.Tweet.Coordinates);
                }
            };

            <span class="pl-k">await</span> <span class="pl-c1">this</span>.CurrentStream.StartStreamMatchingAllConditionsAsync();
        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">StopStreaming</span>()
        {
            <span class="pl-k">if</span> (<span class="pl-c1">this</span>.CurrentStream != <span class="pl-c1">null</span> &amp;&amp; <span class="pl-c1">this</span>.CurrentStream.StreamState != StreamState.Stop) <span class="pl-c1">this</span>.CurrentStream.StopStream();
        }

        <span class="pl-k">private</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">AddActivityAsync</span>(<span class="pl-en">ICoordinates</span> <span class="pl-smi">coordinates</span>)
        {
            <span class="pl-k">await</span> Helpers.StreamHelper.AddTwitterActivityAsync(coordinates.Latitude, coordinates.Longitude);
        }
    }
}</pre></div>
</li>
<li>
<p>Right-click the <strong>TwitterBI.iOS</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>StreamService.cs</strong>. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;

<span class="pl-k">using</span> <span class="pl-en">Foundation</span>;
<span class="pl-k">using</span> <span class="pl-en">UIKit</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.iOS.DependencyServices</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Streaming</span>;

[assembly: Xamarin.Forms.Dependency(typeof(StreamService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.iOS.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">StreamService</span> : <span class="pl-en">IStreamService</span>
    {
        <span class="pl-k">public </span><span class="pl-en">IFilteredStream</span> <span class="pl-en">CurrentStream</span> = <span class="pl-c1">null</span>;

        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">StartStreaming</span>()
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= Auth.CreateCredentials(Common.TwitterConstants.ConsumerKey, Common.TwitterConstants.ConsumerSecret, Common.TwitterConstants.AccessToken, Common.TwitterConstants.AccessSecret);

            <span class="pl-c1">this</span>.CurrentStream = Stream.CreateFilteredStream(credentials);

            <span class="pl-c1">this</span>.CurrentStream.StallWarnings = <span class="pl-c1">true</span>;
            <span class="pl-c1">this</span>.CurrentStream.FilterLevel = Tweetinvi.Streaming.Parameters.StreamFilterLevel.None;
            <span class="pl-c1">this</span>.CurrentStream.AddLocation(<span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.StartingLatitude, Common.TwitterConstants.StartingLongitude), <span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.EndingLatitude, Common.TwitterConstants.EndingLongitude));

            <span class="pl-c1">this</span>.CurrentStream.MatchingTweetReceived += (sender, args) =&gt;
            {
                <span class="pl-k">if</span> (args.Tweet.Coordinates != <span class="pl-c1">null</span>)
                {
                    AddActivityAsync(args.Tweet.Coordinates);
                }
            };

            <span class="pl-k">await</span> <span class="pl-c1">this</span>.CurrentStream.StartStreamMatchingAllConditionsAsync();
        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">StopStreaming</span>()
        {
            <span class="pl-k">if</span> (<span class="pl-c1">this</span>.CurrentStream != <span class="pl-c1">null</span> &amp;&amp; <span class="pl-c1">this</span>.CurrentStream.StreamState != StreamState.Stop) <span class="pl-c1">this</span>.CurrentStream.StopStream();
        }

        <span class="pl-k">private</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">AddActivityAsync</span>(<span class="pl-en">ICoordinates</span> <span class="pl-smi">coordinates</span>)
        {
            <span class="pl-k">await</span> Helpers.StreamHelper.AddTwitterActivityAsync(coordinates.Latitude, coordinates.Longitude);
        }
    }
}</pre></div>
</li>
<li>
<p>Right-click the <strong>TwitterBI.UWP (Universal Windows)</strong> project and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>StreamService.cs</strong>. Then replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Text</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Threading.Tasks</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Models</span>;
<span class="pl-k">using</span> <span class="pl-en">Tweetinvi.Streaming</span>;
<span class="pl-k">using</span> <span class="pl-en">TwitterBI.UWP.DependencyServices</span>;

[assembly: Xamarin.Forms.Dependency(typeof(StreamService))]
<span class="pl-k">namespace</span> <span class="pl-en">TwitterBI.UWP.DependencyServices</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">StreamService</span> : <span class="pl-en">IStreamService</span>
    {
        <span class="pl-k">public </span><span class="pl-en">IFilteredStream</span> <span class="pl-en">CurrentStream</span> = <span class="pl-c1">null</span>;
        <span class="pl-k">public</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">StartStreaming</span>()
        {
            <span class="pl-k">var</span> <span class="pl-en">credentials </span>= Auth.CreateCredentials(Common.TwitterConstants.ConsumerKey, Common.TwitterConstants.ConsumerSecret, Common.TwitterConstants.AccessToken, Common.TwitterConstants.AccessSecret);

            <span class="pl-c1">this</span>.CurrentStream = Stream.CreateFilteredStream(credentials);

            <span class="pl-c1">this</span>.CurrentStream.StallWarnings = <span class="pl-c1">true</span>;
            <span class="pl-c1">this</span>.CurrentStream.FilterLevel = Tweetinvi.Streaming.Parameters.StreamFilterLevel.None;
            <span class="pl-c1">this</span>.CurrentStream.AddLocation(<span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.StartingLatitude, Common.TwitterConstants.StartingLongitude), <span class="pl-k">new</span> <span class="pl-en">Coordinates</span>(Common.TwitterConstants.EndingLatitude, Common.TwitterConstants.EndingLongitude));

            <span class="pl-c1">this</span>.CurrentStream.MatchingTweetReceived += (sender, args) =&gt;
            {
                <span class="pl-k">if</span> (args.Tweet.Coordinates != <span class="pl-c1">null</span>)
                {
                    AddActivityAsync(args.Tweet.Coordinates);
                }
            };

            <span class="pl-k">await</span> <span class="pl-c1">this</span>.CurrentStream.StartStreamMatchingAllConditionsAsync();
        }

        <span class="pl-k">public</span> <span class="pl-k">void</span> <span class="pl-en">StopStreaming</span>()
        {
            <span class="pl-k">if</span> (<span class="pl-c1">this</span>.CurrentStream != <span class="pl-c1">null</span> &amp;&amp; <span class="pl-c1">this</span>.CurrentStream.StreamState != StreamState.Stop) <span class="pl-c1">this</span>.CurrentStream.StopStream();
        }

        <span class="pl-k">private</span> <span class="pl-k">async</span> <span class="pl-k">void</span> <span class="pl-en">AddActivityAsync</span>(<span class="pl-en">ICoordinates</span> <span class="pl-smi">coordinates</span>)
        {
            <span class="pl-k">await</span> Helpers.StreamHelper.AddTwitterActivityAsync(coordinates.Latitude, coordinates.Longitude);
        }
    }
}</pre></div>
</li>
<li>
<p>Launch the app and click the <strong>Start Streaming</strong> button to begin streaming real-time Twitter updates to the Power BI Embedded dataset.</p>
<p><a href="Images/app-click-start-streaming.png" target="_blank"><img src="Images/app-click-start-streaming.png" alt="Streaming Twitter updates" style="max-width:100%;"></a></p>
<p><em>Streaming Twitter updates</em></p>
</li>
<li>
<p>After approximately 60 seconds, click <strong>Stop Streaming</strong>.</p>
</li>
</ol>
<p>At this point, you're probably wondering what's happening since the app shows no visible representation of Twitter activity. That's because one piece of the puzzle is still missing: the piece that runs in the cloud and serves up a Power BI Embedded report for the app to display.</p>
<p><a name="Exercise6"></a></p>
<h2>Exercise 6: Create a Power BI report viewer in an Azure Mobile App</h2>
<p>In this exercise, you will deploy an Azure Mobile App containing a Web page that hosts the Power BI Embedded report that you imported in <a href="#Exercise3">Exercise 3</a>. This will set the stage for the final exercise, in which you will embed that page in the Xamarin Forms app.</p>
<ol>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBI</strong> solution and use the <strong>Add</strong> -&gt; <strong>New Project...</strong> command to add an <strong>ASP.NET Web Application (.NET Framework)</strong> project to the solution. Name the project "TwitterBIMobile."</p>
<p><a href="Images/vs-add-new-web-app.png" target="_blank"><img src="Images/vs-add-new-web-app.png" alt="Adding a project to the solution" style="max-width:100%;"></a></p>
<p><em>Adding a project to the solution</em></p>
</li>
<li>
<p>In the "New ASP.NET Web Application" dialog, select <strong>Azure Mobile App</strong> and click <strong>OK</strong>.</p>
<p><a href="Images/vs-select-mobile-app.png" target="_blank"><img src="Images/vs-select-mobile-app.png" alt="Creating an Azure Mobile App" style="max-width:100%;"></a></p>
<p><em>Creating an Azure Mobile App</em></p>
</li>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBIMobile</strong> project and select <strong>Manage NuGet Packages...</strong>. Then find the package named "Microsoft.PowerBI.Core" and install it.</p>
<p><a href="Images/nuget-pbi-core.png" target="_blank"><img src="Images/nuget-pbi-core.png" alt="Installing Microsoft.PowerBI.Core" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.PowerBI.Core</em></p>
</li>
<li>
<p>Repeat this process to install <strong>Microsoft.PowerBI.Javascript</strong> into the project.</p>
<p><a href="Images/nuget-pbi-js.png" target="_blank"><img src="Images/nuget-pbi-js.png" alt="Installing Microsoft.PowerBI.Javascript" style="max-width:100%;"></a></p>
<p><em>Installing Microsoft.PowerBI.Javascript</em></p>
</li>
<li>
<p>Right-click the <strong>TwitterBIMobile</strong> project and use the <strong>Add</strong> -&gt; <strong>New Folder</strong> command to add a folder named "Common" to the project.</p>
</li>
<li>
<p>Right-click the "Common" folder and use the <strong>Add</strong> -&gt; <strong>Class</strong> command to add a class file named <strong>CoreConstants.cs</strong> to the folder. Replace the contents of the file with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Web</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBIMobile.Common</span>
{
    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">PowerBIConstants</span>
    {
        <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">WorkspaceCollectionName</span> = <span class="pl-s"><span class="pl-pds">"</span>twitterbi<span class="pl-pds">"</span></span>;
        <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">AccessKey</span> = <span class="pl-s"><span class="pl-pds">"</span>POWER_BI_EMBEDDED_ACCESS_KEY<span class="pl-pds">"</span></span>;
    }
}</pre></div>
</li>
<li>
<p>Right-click the "Controllers" folder and select <strong>Add</strong> -&gt; <strong>Controller...</strong>. Select <strong>MVC 5 Controller - Empty</strong> as the controller type and click <strong>Add</strong>.</p>
<p><a href="Images/vs-pick-mvc.png" target="_blank"><img src="Images/vs-pick-mvc.png" alt="Adding a controller" style="max-width:100%;"></a></p>
<p><em>Adding a controller</em></p>
</li>
<li>
<p>Enter "ReportsController" as the controller name and click <strong>Add</strong>.</p>
<p><a href="Images/vs-name-controller.png" target="_blank"><img src="Images/vs-name-controller.png" alt="Naming the controller" style="max-width:100%;"></a></p>
<p><em>Naming the controller</em></p>
</li>
<li>
<p>Replace the contents of <strong>ReportsController.cs</strong> with the following code:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">using</span> <span class="pl-en">Microsoft.PowerBI.Security</span>;
<span class="pl-k">using</span> <span class="pl-en">System</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Collections.Generic</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Linq</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Web</span>;
<span class="pl-k">using</span> <span class="pl-en">System.Web.Mvc</span>;

<span class="pl-k">namespace</span> <span class="pl-en">TwitterBIMobile.Controllers</span>
{
    <span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ReportsController</span> : <span class="pl-en">Controller</span>
    {
        <span class="pl-c">// GET: Reports</span>
        <span class="pl-k">public</span> <span class="pl-en">ActionResult</span> <span class="pl-en">Index</span>(<span class="pl-k">string</span> <span class="pl-smi">workspaceId</span>, <span class="pl-k">string</span> <span class="pl-smi">reportId</span>)
        {
            ViewBag.Title = <span class="pl-s"><span class="pl-pds">"</span>Reports<span class="pl-pds">"</span></span>;

            <span class="pl-k">if</span> (!<span class="pl-k">string</span>.IsNullOrEmpty(workspaceId) &amp;&amp; !<span class="pl-k">string</span>.IsNullOrEmpty(reportId))
            {
                <span class="pl-k">var</span> <span class="pl-en">token </span>= PowerBIToken.CreateReportEmbedToken(Common.PowerBIConstants.WorkspaceCollectionName, workspaceId, reportId, <span class="pl-s"><span class="pl-pds">"</span>R<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-k">string</span>[] { <span class="pl-s"><span class="pl-pds">"</span>R<span class="pl-pds">"</span></span> }, <span class="pl-s"><span class="pl-pds">"</span>Report.Read<span class="pl-pds">"</span></span>);
                <span class="pl-k">var</span> <span class="pl-en">accessToken </span>= token.Generate(Common.PowerBIConstants.AccessKey);
                ViewBag.ReportId = reportId;
                ViewBag.AccessToken = accessToken;
            }

            <span class="pl-k">return</span> View();
        }
    }
}</pre></div>
</li>
<li>
<p>Right-click the project's "Views\Reports" folder and select <strong>Add</strong> -&gt; <strong>New Scaffolding Item...</strong> Select <strong>MVC 5 View</strong> and click <strong>Add</strong>.</p>
<p><a href="Images/vs-add-new-view.png" target="_blank"><img src="Images/vs-add-new-view.png" alt="Adding a view" style="max-width:100%;"></a></p>
<p><em>Adding a view</em></p>
</li>
<li>
<p>Enter "Index" as the view name and click <strong>Add</strong> to add a file named <strong>Index.cshtml</strong> to the project.</p>
<p><a href="Images/vs-add-index-view.png" target="_blank"><img src="Images/vs-add-index-view.png" alt="Naming the view" style="max-width:100%;"></a></p>
<p><em>Naming the view</em></p>
</li>
<li>
<p>Replace the contents of <strong>Index.cshtml</strong> with the following statements:</p>
<div class="highlight highlight-text-html-basic"><pre>@{
ViewBag.Title = "Reports";
}

&lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>reportContainer<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">div</span>&gt;

&lt;<span class="pl-ent">script</span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span>&gt;<span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">var</span> embedConfiguration <span class="pl-k">=</span> {</span>
<span class="pl-s1">        type<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>report<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        accessToken<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>@ViewBag.AccessToken<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        id<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>@ViewBag.ReportId<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">        embedUrl<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>https://embedded.powerbi.com/appTokenReportEmbed<span class="pl-pds">'</span></span></span>
<span class="pl-s1">    };</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-k">var</span> $reportContainer <span class="pl-k">=</span> <span class="pl-en">$</span>(<span class="pl-s"><span class="pl-pds">'</span>#reportContainer<span class="pl-pds">'</span></span>);</span>
<span class="pl-s1">    <span class="pl-k">var</span> report <span class="pl-k">=</span> <span class="pl-smi">powerbi</span>.<span class="pl-en">embed</span>(<span class="pl-smi">$reportContainer</span>.<span class="pl-c1">get</span>(<span class="pl-c1">0</span>), embedConfiguration);</span>
<span class="pl-s1"></span>
<span class="pl-s1"></span><span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
</pre></div>
</li>
<li>
<p>Open <strong>_Layout.cshtml</strong> in the "Views\Shared" folder and replace the contents of the file with the following code:</p>
<div class="highlight highlight-text-html-basic"><pre>&lt;!DOCTYPE html&gt;
&lt;<span class="pl-ent">html</span>&gt;
&lt;<span class="pl-ent">head</span>&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">charset</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">meta</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>viewport<span class="pl-pds">"</span></span> <span class="pl-e">content</span>=<span class="pl-s"><span class="pl-pds">"</span>width=device-width<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">title</span>&gt;@ViewBag.Title&lt;/<span class="pl-ent">title</span>&gt;
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>~/Scripts/jquery-1.10.2.js<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> <span class="pl-e">language</span>=<span class="pl-s"><span class="pl-pds">"</span>javascript<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;
    &lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>~/Scripts/powerbi.js<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>text/javascript<span class="pl-pds">"</span></span> <span class="pl-e">language</span>=<span class="pl-s"><span class="pl-pds">"</span>javascript<span class="pl-pds">"</span></span>&gt;<span class="pl-s1">&lt;</span>/<span class="pl-ent">script</span>&gt;

    &lt;<span class="pl-ent">style</span>&gt;<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-ent">html</span>, <span class="pl-ent">body</span> {</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">margin</span></span>: <span class="pl-c1">0<span class="pl-k">px</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">0<span class="pl-k">px</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1"></span>
<span class="pl-s1">        <span class="pl-e">.container</span> {</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">height</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">width</span></span>: <span class="pl-c1">100<span class="pl-k">%</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">margin</span></span>: <span class="pl-c1">0<span class="pl-k">px</span></span>;</span>
<span class="pl-s1">            <span class="pl-c1"><span class="pl-c1">padding</span></span>: <span class="pl-c1">0<span class="pl-k">px</span></span>;</span>
<span class="pl-s1">        }</span>
<span class="pl-s1">    </span><span class="pl-s1">&lt;</span>/<span class="pl-ent">style</span>&gt;

&lt;/<span class="pl-ent">head</span>&gt;
&lt;<span class="pl-ent">body</span>&gt;

    &lt;<span class="pl-ent">div</span> <span class="pl-e">class</span>=<span class="pl-s"><span class="pl-pds">"</span>container body-content<span class="pl-pds">"</span></span>&gt;
        @RenderBody()
    &lt;/<span class="pl-ent">div</span>&gt;

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
&lt;/<span class="pl-ent">body</span>&gt;
&lt;/<span class="pl-ent">html</span>&gt;</pre></div>
</li>
<li>
<p>Right-click the "Views" folder and select <strong>Add</strong> -&gt; <strong>New Item...</strong>. Select <strong>Web Configuration File</strong>, enter "Web.config" as the file name, and click <strong>Add</strong>.</p>
<p><a href="Images/vs-add-new-config.png" target="_blank"><img src="Images/vs-add-new-config.png" alt="Adding a Web.config file to the &quot;Views&quot; folder" style="max-width:100%;"></a></p>
<p><em>Adding a Web.config file to the "Views" folder</em></p>
</li>
<li>
<p>Replace the contents of the new <strong>Web.config</strong> file with the following XML:</p>
<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span>?&gt;
&lt;<span class="pl-ent">configuration</span>&gt;
  &lt;<span class="pl-ent">configSections</span>&gt;
    &lt;<span class="pl-ent">sectionGroup</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>system.web.webPages.razor<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">section</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="pl-pds">"</span></span> <span class="pl-e">requirePermission</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> /&gt;
      &lt;<span class="pl-ent">section</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>pages<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=3.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="pl-pds">"</span></span> <span class="pl-e">requirePermission</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">sectionGroup</span>&gt;
  &lt;/<span class="pl-ent">configSections</span>&gt;

  &lt;<span class="pl-ent">system</span>.web.webPages.razor&gt;
    &lt;<span class="pl-ent">host</span> <span class="pl-e">factoryType</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=5.2.3.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35<span class="pl-pds">"</span></span> /&gt;
    &lt;<span class="pl-ent">pages</span> <span class="pl-e">pageBaseType</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Mvc.WebViewPage<span class="pl-pds">"</span></span>&gt;
      &lt;<span class="pl-ent">namespaces</span>&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Mvc<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Mvc.Ajax<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Mvc.Html<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Routing<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.Optimization<span class="pl-pds">"</span></span> /&gt;
        &lt;<span class="pl-ent">add</span> <span class="pl-e">namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBIMobile<span class="pl-pds">"</span></span> /&gt;
      &lt;/<span class="pl-ent">namespaces</span>&gt;
    &lt;/<span class="pl-ent">pages</span>&gt;
  &lt;/<span class="pl-ent">system</span>.web.webPages.razor&gt;

  &lt;<span class="pl-ent">appSettings</span>&gt;
    &lt;<span class="pl-ent">add</span> <span class="pl-e">key</span>=<span class="pl-s"><span class="pl-pds">"</span>webpages:Enabled<span class="pl-pds">"</span></span> <span class="pl-e">value</span>=<span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span> /&gt;
  &lt;/<span class="pl-ent">appSettings</span>&gt;

  &lt;<span class="pl-ent">system</span>.webServer&gt;
    &lt;<span class="pl-ent">handlers</span>&gt;
      &lt;<span class="pl-ent">remove</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>BlockViewHandler<span class="pl-pds">"</span></span>/&gt;
      &lt;<span class="pl-ent">add</span> <span class="pl-e">name</span>=<span class="pl-s"><span class="pl-pds">"</span>BlockViewHandler<span class="pl-pds">"</span></span> <span class="pl-e">path</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> <span class="pl-e">verb</span>=<span class="pl-s"><span class="pl-pds">"</span>*<span class="pl-pds">"</span></span> <span class="pl-e">preCondition</span>=<span class="pl-s"><span class="pl-pds">"</span>integratedMode<span class="pl-pds">"</span></span> <span class="pl-e">type</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.HttpNotFoundHandler<span class="pl-pds">"</span></span> /&gt;
    &lt;/<span class="pl-ent">handlers</span>&gt;
  &lt;/<span class="pl-ent">system</span>.webServer&gt;
&lt;/<span class="pl-ent">configuration</span>&gt;</pre></div>
</li>
<li>
<p>Open <strong>CoreConstants.cs</strong> in the "Common" folder of the <strong>TwitterBI (Portable)</strong> project. Copy the value of the <code>AccessKey</code> property in the <code>PowerBIConstants</code> class to the clipboard.</p>
<p><a href="Images/vs-original-access-key.png" target="_blank"><img src="Images/vs-original-access-key.png" alt="Copying the access key" style="max-width:100%;"></a></p>
<p><em>Copying the access key</em></p>
</li>
<li>
<p>Now open <strong>CoreConstants.cs</strong> in the <strong>TwitterBIMobile</strong> project and replace <em>POWER_BI_EMBEDDED_ACCESS_KEY</em> with the access key on the clipboard.</p>
<p><a href="Images/vs-new-access-key.png" target="_blank"><img src="Images/vs-new-access-key.png" alt="Pasting the access key" style="max-width:100%;"></a></p>
<p><em>Pasting the access key</em></p>
</li>
<li>
<p>The next step is to publish the Azure Mobile App. Right-click the <strong>TwitterBIMobile</strong> project and select <strong>Publish</strong>.</p>
<p><a href="Images/vs-select-publish.png" target="_blank"><img src="Images/vs-select-publish.png" alt="Publishing the Azure Mobile App" style="max-width:100%;"></a></p>
<p><em>Publishing the Azure Mobile App</em></p>
</li>
<li>
<p>Select <strong>Microsoft Azure App Service</strong>, ensure <strong>Create New</strong> is selected, and click <strong>Publish</strong>.</p>
<p><a href="Images/vs-publish-to-azure.png" target="_blank"><img src="Images/vs-publish-to-azure.png" alt="Publishing the Azure Mobile App" style="max-width:100%;"></a></p>
<p><em>Publishing the Azure Mobile App</em></p>
</li>
<li>
<p>In the "Create App Service" dialog, select the <strong>PowerBIResources</strong> resource group that you created for the workspace collection in <a href="#Exercise1">Exercise 1</a>, and click <strong>Create</strong>.</p>
<p><a href="Images/vs-click-create-service.png" target="_blank"><img src="Images/vs-click-create-service.png" alt="Creating an Azure App Service" style="max-width:100%;"></a></p>
<p><em>Creating an Azure App Service</em></p>
</li>
<li>
<p>Confirm that the Azure Mobile App appears in your browser.</p>
<p><a href="Images/web-new-landing-page.png" target="_blank"><img src="Images/web-new-landing-page.png" alt="The Azure Mobile App" style="max-width:100%;"></a></p>
<p><em>The Azure Mobile App</em></p>
</li>
</ol>
<p>Leave the browser open, because you will be returning to this page in the next exercise. Now it's time to experience what you've worked so hard for: viewing real-time Twitter activity in a Power BI report in your Twitter BI app.</p>
<p><a name="Exercise7"></a></p>
<h2>Exercise 7: Connect the Xamarin Forms app to the report viewer</h2>
<p>In the final exercise, you will add a page to the Xamarin Forms app that contains a <code>WebView</code> control, and connect the <code>WebView</code> control to the page in the Azure Mobile App that you deployed in the previous exercise so the report is visible in the Xamarin Forms app. It has been a long journey, but you have almost arrived at the destination.</p>
<ol>
<li>
<p>In Solution Explorer, right-click the <strong>TwitterBI (Portable)</strong> project and use the <strong>Add</strong> -&gt; <strong>New Item...</strong> command to add a blank page named <strong>ViewReportPage.xaml</strong> to the project.</p>
<p><a href="Images/vs-add-report-page.png" target="_blank"><img src="Images/vs-add-report-page.png" alt="Adding a page to the app" style="max-width:100%;"></a></p>
<p><em>Adding a page to the app</em></p>
</li>
<li>
<p>Replace the contents of <strong>ViewReportPage.xaml</strong> with the following XAML:</p>
<div class="highlight highlight-text-xml"><pre>&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span><span class="pl-e"> encoding</span>=<span class="pl-s"><span class="pl-pds">"</span>utf-8<span class="pl-pds">"</span></span> ?&gt;
&lt;<span class="pl-ent">ContentPage</span> <span class="pl-e">xmlns</span>=<span class="pl-s"><span class="pl-pds">"</span>http://xamarin.com/schemas/2014/forms<span class="pl-pds">"</span></span> <span class="pl-e">Title</span>=<span class="pl-s"><span class="pl-pds">"</span>Twitter Activity<span class="pl-pds">"</span></span>
             <span class="pl-e">xmlns</span><span class="pl-e">:</span><span class="pl-e">x</span>=<span class="pl-s"><span class="pl-pds">"</span>http://schemas.microsoft.com/winfx/2009/xaml<span class="pl-pds">"</span></span>
             <span class="pl-e">x</span><span class="pl-e">:</span><span class="pl-e">Class</span>=<span class="pl-s"><span class="pl-pds">"</span>TwitterBI.ViewReportPage<span class="pl-pds">"</span></span>&gt;
    &lt;<span class="pl-ent">Grid</span>&gt;
        &lt;<span class="pl-ent">WebView</span> <span class="pl-e">Source</span>=<span class="pl-s"><span class="pl-pds">"</span>{Binding ReportViewerUrl}<span class="pl-pds">"</span></span> <span class="pl-e">IsVisible</span>=<span class="pl-s"><span class="pl-pds">"</span>True<span class="pl-pds">"</span></span> <span class="pl-e">VerticalOptions</span>=<span class="pl-s"><span class="pl-pds">"</span>Fill<span class="pl-pds">"</span></span> <span class="pl-e">HorizontalOptions</span>=<span class="pl-s"><span class="pl-pds">"</span>Fill<span class="pl-pds">"</span></span>/&gt;
    &lt;/<span class="pl-ent">Grid</span>&gt;
&lt;/<span class="pl-ent">ContentPage</span>&gt;</pre></div>
<p>This page contains a <code>WebView</code> control which is capable of displaying HTML content. You are effectively embedding a browser inside a page in a mobile app.</p>
</li>
<li>
<p>Open <strong>ViewReportPage.xaml.cs</strong> and insert enter the following code below the class constructor to override the <code>OnAppearing</code> method:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">protected</span> <span class="pl-k">override</span> <span class="pl-k">void</span> <span class="pl-en">OnAppearing</span>()
{
    <span class="pl-c1">base</span>.OnAppearing();
    <span class="pl-c1">this</span>.BindingContext = App.ViewModel;
}</pre></div>
</li>
<li>
<p>Open <strong>CoreConstants.cs</strong> in the project's "Common" folder. Insert the following class below the <code>TwitterConstants</code> class:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">class</span> <span class="pl-en">AzureMobileConstants</span>
{
    <span class="pl-k">public static </span><span class="pl-k">string</span> <span class="pl-en">MobileServiceUrl</span> = <span class="pl-s"><span class="pl-pds">"</span>AZURE_MOBILE_APP_URL<span class="pl-pds">"</span></span>;
}</pre></div>
</li>
<li>
<p>Return to the browser where the Azure Mobile App is displayed and copy the URL in the address bar to the clipboard.</p>
<p><a href="Images/browser-copy-url.png" target="_blank"><img src="Images/browser-copy-url.png" alt="Copying the URL to the clipboard" style="max-width:100%;"></a></p>
<p><em>Copying the URL to the clipboard</em></p>
</li>
<li>
<p>Return to Visual Studio and replace <em>AZURE_MOBILE_APP_URL</em> in the code you just added to <strong>CoreConstants.cs</strong> with the URL on the clipboard.</p>
</li>
<li>
<p>Open <strong>PowerBIHelper.cs</strong> in the "Helpers" folder and add the following method just above the <code>CreateWorkspaceAsync</code> method:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">string </span>GenerateReportViewUrl(<span class="pl-k">string </span>workspaceId, <span class="pl-k">string </span>reportId)
{
    <span class="pl-k">return</span> <span class="pl-pds">$"</span>{Common.AzureMobileConstants.MobileServiceUrl}<span class="pl-s">Reports/?workspaceId=</span>{workspaceId}<span class="pl-s">&amp;reportId=</span>{reportId}<span class="pl-pds">"</span>;
}</pre></div>
</li>
<li>
<p>Open <strong>MainViewModel.cs</strong> and add the following code below the class constructor:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> <span class="pl-k">string</span> <span class="pl-en">_reportViewerUrl</span>;
<span class="pl-k">public</span> <span class="pl-k">string </span><span class="pl-en">ReportViewerUrl</span>
{
    <span class="pl-k">get</span> { <span class="pl-k">return</span> <span class="pl-c1">this</span>._reportViewerUrl; }
    <span class="pl-k">set</span> { <span class="pl-c1">this</span>.SetProperty(ref <span class="pl-c1">this</span>._reportViewerUrl, <span class="pl-k">value</span>); }
}</pre></div>
</li>
<li>
<p>Insert the following line of code into the <code>InitializeWorkspaceAsync</code> method at the location pictured below:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-c1">this</span>.<span class="pl-en">ReportViewerUrl</span> = Helpers.PowerBIHelper.<span class="pl-en">GenerateReportViewUrl</span>(<span class="pl-c1">this</span>.CurrentWorkspaceId, <span class="pl-c1">this</span>.CurrentReportId);</pre></div>
<p><a href="Images/vs-add-viewer-url.png" target="_blank"><img src="Images/vs-add-viewer-url.png" alt="Updating the InitializeWorkspaceAsync method" style="max-width:100%;"></a></p>
<p><em>Updating the InitializeWorkspaceAsync method</em></p>
</li>
<li>
<p>Insert the following statement just before the closing <code>&lt;/StackLayout&gt;</code> tag in <strong>MainPage.xaml</strong>:</p>
<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">Button</span> <span class="pl-e">BackgroundColor</span>=<span class="pl-s"><span class="pl-pds">"</span>#00ACED<span class="pl-pds">"</span></span> <span class="pl-e">TextColor</span>=<span class="pl-s"><span class="pl-pds">"</span>Black<span class="pl-pds">"</span></span> <span class="pl-e">Text</span>=<span class="pl-s"><span class="pl-pds">"</span>View Activity<span class="pl-pds">"</span></span> <span class="pl-e">Clicked</span>=<span class="pl-s"><span class="pl-pds">"</span>OnViewActivityClicked<span class="pl-pds">"</span></span>/&gt;</pre></div>
</li>
<li>
<p>Add the following method to the <code>MainPage</code> class in <strong>MainPage.xaml.cs</strong>:</p>
<div class="highlight highlight-source-cs"><pre><span class="pl-k">private</span> <span class="pl-k">void</span> <span class="pl-en">OnViewActivityClicked</span>(<span class="pl-k">object</span> <span class="pl-smi">sender</span>, <span class="pl-en">EventArgs</span> <span class="pl-smi">e</span>)
{
    Navigation.PushAsync(<span class="pl-k">new</span> <span class="pl-en">ViewReportPage</span>(), <span class="pl-c1">true</span>);
}</pre></div>
</li>
<li>
<p>Now it's time to see some results. Launch the app and click <strong>Start Streaming</strong>. Let it run for 3 or 4 minutes, and then click <strong>View Activity</strong>.</p>
<p><a href="Images/app-view-activity.png" target="_blank"><img src="Images/app-view-activity.png" alt="Viewing Twitter activity in the app" style="max-width:100%;"></a></p>
<p><em>Viewing Twitter activity in the app</em></p>
</li>
<li>
<p>Confirm that a map showing real-time Twitter activity appears.</p>
<p><a href="Images/app-activity.png" target="_blank"><img src="Images/app-activity.png" alt="Map rendered by Power BI Embedded" style="max-width:100%;"></a></p>
<p><em>Map rendered by Power BI Embedded</em></p>
</li>
<li>
<p>Click <strong>Statistics</strong> to see a different view of Twitter activity.</p>
<p><a href="Images/app-stats.png" target="_blank"><img src="Images/app-stats.png" alt="Switching to Statistics view" style="max-width:100%;"></a></p>
<p><em>Switching to Statistics view</em></p>
</li>
</ol>
<p>Play with the app and notice that you can even filter results based on latitude and longitude. Voila! A Power BI report hosted in a Web page using Power BI Embedded, and surfaced in a <code>WebView</code> control in a page in a Xamarin Forms app.</p>
<p><a name="Summary"></a></p>
<h2>Summary</h2>
<p>It required no small amount of work to host a Power BI Embedded report in a Xamarin Forms app, but hopefully you will judge that the results are worth it. Note that <em>any</em> Power BI report can be hosted this way, and that Power BI provides a tremendous amount of power and flexibility when it comes to generating reports. If you're new to Power BI and want to learn more about creating reports and the various visualizations Power BI supports, see <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-service-create-a-new-report/">https://powerbi.microsoft.com/en-us/documentation/powerbi-service-create-a-new-report/</a>. And for a hands-on tutorial demonstrating the basics of Power BI, see <a href="https://github.com/Microsoft/TechnicalCommunityContent/tree/master/Advanced%20Analytics/Power%20BI/Session%202%20-%20Hands%20On">Using Microsoft Power BI to Explore and Visualize Data</a>.</p>
<hr>
<p>Copyright 2017 Microsoft Corporation. All rights reserved. Except where otherwise noted, these materials are licensed under the terms of the MIT License. You may use them according to the license as is most appropriate for your project. The terms of this license can be found at <a href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a>.</p>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
